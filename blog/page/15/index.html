
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Michael Herman</title>
  <meta name="author" content="Michael Herman">

  
  <meta name="description" content="Alright. In this tutorial I&#8217;ll show you how to modify the controller so that the end user can update and delete records. At this point, I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mjhea0.github.com/blog/page/15">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/jquery.messagebar.min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Michael Herman" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.messagebar.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37074204-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner">
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mjhea0.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2012/12/09/crash-course-in-web2py-part-4-managing-form-records/">Crash Course in Web2py (Part 4 - Managing Form Records)</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2012-12-09T22:32:00-07:00" pubdate data-updated="true">Dec 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Alright. In this tutorial I&#8217;ll show you how to modify the controller so that the end user can update and delete records. At this point, I assume:</p>

<ol>
<li>You have web2py already installed => <a href="http://mherman.org/blog/2012/11/27/crash-course-in-web2py-part-1/">part 1</a></li>
<li>You created the skeleton web form => <a href="http://mherman.org/blog/2012/12/01/crash-course-in-web2py-part-2-web-forms/">part 2</a></li>
<li>You added data validation (with the help of Han Solo) => <a href="http://mherman.org/blog/2012/12/06/crash-course-in-web2py-part-3-form-validation/">part 3</a></li>
</ol>


<p>Let&#8217;s begin &#8230;</p>

<p>(1) Launch the server. (2) Go to the admin interface. (3) Edit the &#8220;form&#8221; application.</p>

<h2><strong>Controller</strong></h2>

<p>Add the following code to <em>default.py</em> just before the SQLFORM function, then add the variable to the function itself:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">update</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span class='line'><span class="n">form</span> <span class="o">=</span> <span class="n">SQLFORM</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Essentially, <em>request.args()</em> pulls up a user record associated with a specific unique ID.</p>

<h2>Test</h2>

<p>Test this out by adding a new record to the database @ <a href="http://127.0.0.1:8000/form/default/display_your_form.html">http://127.0.0.1:8000/form/default/display_your_form.html</a>. Make note of the unique id in the <em>Accepted Fields</em> section.</p>

<p><img src="http://www.backwardsteps.com/uploads/2012-12-08_2055.png" alt="" /></p>

<p>Now append that unique id to the end of the base URL - e.g., <a href="http://127.0.0.1:8000/form/default/display_your_form/21">http://127.0.0.1:8000/form/default/display_your_form/21</a> - and the record should appear on a new page, which the user can update.</p>

<hr />

<p>Please note: you can add <em>writable=False</em> or <em>readable=False</em> to the fields in the database to prevent a user from either editing or viewing a particular field. In the example below, I added <em>writable=False</em> to the <em>first_name</em> field.</p>

<p><img src="http://www.backwardsteps.com/uploads/2012-12-08_2111.png" alt="" /></p>

<p>So, now the user can only edit the last name and email fields.</p>

<hr />

<p>Moving on, for this process to work right, the user making the edits must know the unique id beforehand, which is unrealistic. web2py has a solution for that - <em>grid</em>.</p>

<h2>Controller</h2>

<p>The <em>grid</em> method is just wonderful. You have to see it to believe it. Quickly now, add the following function to <em>default.py</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">all_records</span><span class="p">():</span>
</span><span class='line'>    <span class="n">grid</span> <span class="o">=</span> <span class="n">SQLFORM</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">register</span><span class="p">,</span><span class="n">user_signature</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Navigate to the following URL - <a href="http://127.0.0.1:8000/form/default/all_records">http://127.0.0.1:8000/form/default/all_records</a></p>

<p>Wow.</p>

<p>The end user can now perform the CRUD functions as well as search and sort all the records in the database - and it literally took twenty seconds to add this functionality. You can, of course, also require user authentication so only certain users can edit, while other users have read-only access.</p>

<h2>Model</h2>

<p>Finally, let&#8217;s add two more validators to the form. Go to your database.</p>

<p>I want the user to validate his/her email address and I want it to be unique, so update db.py with the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">db</span> <span class="o">=</span> <span class="n">DAL</span><span class="p">(</span><span class="s">&#39;sqlite://webform.sqlite&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span><span class="s">&#39;register&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Field</span><span class="p">(</span><span class="s">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="n">IS_NOT_EMPTY</span><span class="p">(),</span> <span class="n">IS_ALPHANUMERIC</span><span class="p">()]),</span>
</span><span class='line'>    <span class="n">Field</span><span class="p">(</span><span class="s">&#39;last_name&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="n">IS_NOT_EMPTY</span><span class="p">(),</span> <span class="n">IS_ALPHANUMERIC</span><span class="p">()]),</span>
</span><span class='line'>    <span class="n">Field</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="n">IS_NOT_EMPTY</span><span class="p">(),</span> <span class="n">IS_EMAIL</span><span class="p">()]),</span>
</span><span class='line'>    <span class="n">Field</span><span class="p">(</span><span class="s">&#39;email_validate&#39;</span><span class="p">,</span><span class="n">requires</span><span class="o">=</span><span class="n">IS_EQUAL_TO</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">email</span><span class="p">)))</span>
</span><span class='line'><span class="n">db</span><span class="o">.</span><span class="n">register</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_IN_DB</span><span class="p">(</span><span class="n">db</span><span class="p">,</span><span class="s">&#39;register.email&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Take note of lines 5, 6, and 7.</p>

<h2>Test</h2>

<p>Test this by first trying two different email addresses:</p>

<p><img src="http://www.backwardsteps.com/uploads/2012-12-08_2238.png" alt="" /></p>

<p>Then test it again with an email you know is already in the database.</p>

<p><img src="http://www.backwardsteps.com/uploads/2012-12-08_2240.png" alt="" /></p>

<p>Perfect.</p>

<p>Well, we could edit the actual errors that populate, but that&#8217;s a bit more complicated. They&#8217;ll suffice for now.</p>

<h2>Recap</h2>

<p>Again, by adding just a few statements we added much functionality to our form, highlighting the power of such web frameworks like web2py. Well. that&#8217;s it for now. In the <a href="http://mherman.org/blog/2012/12/10/crash-course-in-web2py-part-5-modifying-the-appearance-and-deploying-the-web-form/#.U5bvQJRdUZ0">next</a> tutorial, I&#8217;ll show you in brief how to modify the form&#8217;s appearance via the CSS files. Oh - and we&#8217;ll finally deploy the finished app!</p>

<p>You can find the new code for db.py, display_your_form.html, and default.py <a href="https://github.com/mjhea0/web2py/tree/master/form%20-%20part%203">here</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2012/12/06/crash-course-in-web2py-part-3-form-validation/">Crash Course in Web2py (Part 3 - Form Validation)</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2012-12-06T21:52:00-07:00" pubdate data-updated="true">Dec 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Well, in the last <a href="http://mherman.org/blog/2012/12/01/crash-course-in-web2py-part-2-web-forms/">tutorial</a> I showed you  how to create a basic web form that stores the submitted data in a SQLite database. In this tutorial, we&#8217;re going to add in data validation to your form.</p>

<p><em>Assumptions:</em></p>

<ol>
<li>You <a href="http://mherman.org/blog/2012/11/27/crash-course-in-web2py-part-1/">installed</a> web2py</li>
<li>You created the skeleton web form from <a href="http://mherman.org/blog/2012/12/01/crash-course-in-web2py-part-2-web-forms/#.U5btEpRdUZ0">Part 2</a></li>
</ol>


<p>Start the web2py server, go to the admin interface, and then edit the &#8220;form&#8221; application (or whatever you decided to name it).</p>

<h2>Model</h2>

<p>Right now, there is a requirement set in the db.py file for each field-</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span>
</span></code></pre></td></tr></table></div></figure>


<p>In other words - all fields must be filled out or an error populates.</p>

<h2>View</h2>

<p>What do you want to display to the user?</p>

<p>Open up display_your_form.html and change your code to match the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">{{</span><span class="n">extend</span> <span class="s">&#39;layout.html&#39;</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Web</span> <span class="n">Form</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Please</span> <span class="n">enter</span> <span class="n">your</span> <span class="n">first</span> <span class="ow">and</span> <span class="n">last</span> <span class="n">names</span><span class="p">,</span> <span class="ow">and</span> <span class="n">email</span> <span class="n">address</span><span class="o">.&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="n">Please</span> <span class="n">note</span><span class="p">:</span> <span class="n">All</span> <span class="n">attempts</span> <span class="n">must</span> <span class="n">be</span> <span class="n">error</span> <span class="n">free</span> <span class="n">before</span> <span class="nb">any</span> <span class="n">info</span> <span class="ow">is</span> <span class="n">accepted</span><span class="o">.&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="n">Inputs</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">h2</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">{{</span><span class="o">=</span><span class="n">form</span><span class="p">}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="n">Submitted</span> <span class="n">Fields</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">h2</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">{{</span><span class="o">=</span><span class="n">BEAUTIFY</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">vars</span><span class="p">)}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="n">Accepted</span> <span class="n">Fields</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">h2</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">{{</span><span class="o">=</span><span class="n">BEAUTIFY</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">vars</span><span class="p">)}}</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="n">Errors</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">h2</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">{{</span><span class="o">=</span><span class="n">BEAUTIFY</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)}}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>By adding <em>{ {extend &#8216;layout.html&#8217;}}</em>, you will be able to display the flash error messages, which we&#8217;ll add in next.</p>

<h2>Controller</h2>

<p>Update deafult.py to match the following code-</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">display_your_form</span><span class="p">():</span>
</span><span class='line'>    <span class="n">form</span> <span class="o">=</span> <span class="n">SQLFORM</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">register</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">accepts</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">session</span><span class="p">):</span>
</span><span class='line'>        <span class="n">response</span><span class="o">.</span><span class="n">flash</span> <span class="o">=</span> <span class="s">&#39;Thanks! The form has been submitted.&#39;</span>
</span><span class='line'>    <span class="k">elif</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
</span><span class='line'>       <span class="n">response</span><span class="o">.</span><span class="n">flash</span> <span class="o">=</span> <span class="s">&#39;Please correct the error(s).&#39;</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>       <span class="n">response</span><span class="o">.</span><span class="n">flash</span> <span class="o">=</span> <span class="s">&#39;Try again - no fields can be empty.&#39;</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This adds an If Statement to display text based on whether the user submits your form with the required fields or not.</p>

<h2>Test</h2>

<ol>
<li>Go to <a href="http://127.0.0.1:8000/form/default/display_your_form.html">http://127.0.0.1:8000/form/default/display_your_form.html</a>.</li>
<li>Enter your first name, last name, and email.</li>
<li>Your output should look similar to this-</li>
</ol>


<p><img src="http://www.backwardsteps.com/uploads/2012-12-05_0954.png" alt="" /></p>

<p>As long as no fields are blank, you won&#8217;t see any errors - and the data will be added to the database. Notice how you can now see the unique identifier. The message &#8220;Thanks! The form has been submitted.&#8221; is visible in the top right corner, as well.</p>

<p>How does this work?</p>

<p>Well, when a field is submitted, it&#8217;s filtered through the <em>accepts</em> method from the Controller, according to the requirements specified in the database schema (<em>IS_NOT_EMPTY)</em>. If the field meets the requirement (accepts returns <em>True)</em>, it&#8217;s passed to <em>form.vars</em>; if not (accepts returns <em>False)</em>, an error populates, which is then stored in <em>form.errors</em>.</p>

<p>Got it?</p>

<p>See what happens when you enter an error.</p>

<p><img src="http://www.backwardsteps.com/uploads/2012-12-05_1001.png" alt="" /></p>

<p>So when Han forgets his last name and just decides to leave it blank, the field values that meet the requirement are still passed. But they are not added to the database, since there is an error. And you should see an error message in the top right corner. As soon as he remembers, he can go back and correct. Poor Han.</p>

<p>What happens though if he gets confused and enters his first name correctly, but enters his last name in the email field and his email in the last name field? Try it. You should not see an error.</p>

<p>This is a problem. Let&#8217;s add additional requirements to prevent this from happening.</p>

<h2>Model</h2>

<p>Update the code in db.py to match the following-</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">db</span> <span class="o">=</span> <span class="n">DAL</span><span class="p">(</span><span class="s">&#39;sqlite://webform.sqlite&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span><span class="s">&#39;register&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Field</span><span class="p">(</span><span class="s">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="n">IS_NOT_EMPTY</span><span class="p">(),</span> <span class="n">IS_ALPHANUMERIC</span><span class="p">()]),</span>
</span><span class='line'>    <span class="n">Field</span><span class="p">(</span><span class="s">&#39;last_name&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="n">IS_NOT_EMPTY</span><span class="p">(),</span> <span class="n">IS_ALPHANUMERIC</span><span class="p">()]),</span>
</span><span class='line'>    <span class="n">Field</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="p">[</span><span class="n">IS_NOT_EMPTY</span><span class="p">(),</span> <span class="n">IS_EMAIL</span><span class="p">()]))</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><em>IS_ALPHANUMERIC()</em> requires that the field can only contain characters ranging from a-z, A-Z, or 0-9</li>
<li><em>IS_EMAIL</em> requires that the field value must look like an email address</li>
</ul>


<p>Now watch happens when you switch the last name and email address.</p>

<p><img src="http://www.backwardsteps.com/uploads/2012-12-05_1007.png" alt="" /></p>

<p>Good. Now he just needs to enter the correct value in the correct fields.</p>

<p>Hey - at least he remembered his last name.</p>

<h2>Recap</h2>

<p>By just tweaking the code a bit, we added basic validation to ensure that no fields are empty and to limit any data integrity issues. Again - Do not deploy the app on PythonAnywhere just yet. We still have more features to add, but we are well underway on having the best form on the Internet.</p>

<p>You can find the new code for db.py, display_your_form.html, and default.py <a href="https://github.com/mjhea0/web2py/tree/master/form%20-%20part%202">here</a>. When ready, move on to <a href="http://mherman.org/blog/2012/12/09/crash-course-in-web2py-part-4-managing-form-records/#.U5bvg5RdUZ0">Part 4</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
  
    
      <h1 class="entry-title"><a href="/blog/2012/12/01/crash-course-in-web2py-part-2-web-forms/">Crash Course in Web2py (Part 2 - Web Forms)</a></h1>
      
      
    
      <p class="meta">
        








  


<time datetime="2012-12-01T21:27:00-07:00" pubdate data-updated="true">Dec 1<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In the last <a href="http://mherman.org/blog/2012/11/27/crash-course-in-web2py-part-1/">tutorial</a> I showed you the basics of web2py, and we even created a web app in less than ten minutes! In Part 2, I&#8217;ll show you how to create a basic web form that stores the submitted data in a SQLite database.</p>

<p><em>Assumptions:</em></p>

<ol>
<li>You <a href="http://mherman.org/blog/2012/11/27/crash-course-in-web2py-part-1/">installed</a> web2py</li>
<li>You know what a web form is</li>
</ol>


<p>Anyway - let&#8217;s get going &#8230;</p>

<h2>MVC Architecture</h2>

<p>Real quick, web2py utilizes the Model View Control (MVC) architecture:</p>

<ul>
<li><em>Model</em> - application data</li>
<li><em>View</em> - portions of the application data that the end user is <em>allowed</em> to see</li>
<li><em>Controller</em> - controls the application workflow and the logic used to display the data to the end user</li>
</ul>


<p>Wikipedia has a great diagram of how each part works together-</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/f/fd/MVC-Process.png" alt="" /></p>

<p>web2py essentially makes it easier for developers to design each part and create the overall workflow to ensure that each part works together. I hope that&#8217;s clear. If not, please comment, and I&#8217;ll go a little more in depth. It&#8217;s important to understand this, as we will be utilizing this form of development from this point on.</p>

<p>Okay - Go ahead and start the web2py server, go to the admin interface, and then create a new application. I named mine &#8220;form&#8221;. Feel free to come up with something a bit more creative.</p>

<h2>Model*</h2>

<p>Open db.py in the Model&#8217;s section and append the following code below, which defines the database schema. There are three required fields, plus a unique ID that is automatically created by web2py.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">db</span> <span class="o">=</span> <span class="n">DAL</span><span class="p">(</span><span class="s">&#39;sqlite://webform.sqlite&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">db</span><span class="o">.</span><span class="n">define_table</span><span class="p">(</span><span class="s">&#39;register&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Field</span><span class="p">(</span><span class="s">&#39;first_name&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
</span><span class='line'>    <span class="n">Field</span><span class="p">(</span><span class="s">&#39;last_name&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()),</span>
</span><span class='line'>    <span class="n">Field</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="n">requires</span><span class="o">=</span><span class="n">IS_NOT_EMPTY</span><span class="p">()))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>View</h2>

<p>Create a new HTML file named default/display_your_form.html</p>

<p><img src="http://www.backwardsteps.com/uploads/2012-11-30_2319.png" alt="" /></p>

<p>And then add the following code to call the form-</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;center&gt;</span>
</span><span class='line'><span class="nt">&lt;br</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;&lt;br</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;h1&gt;</span>Web Form<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'><span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;h2&gt;</span>Inputs:<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>{{=form}}
</span><span class='line'><span class="nt">&lt;h2&gt;</span>Submitted variables:<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>{{=BEAUTIFY(request.vars)}}
</span><span class='line'><span class="nt">&lt;/center&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Controller</h2>

<p>Finally, comment out all the current code in the default.py file and add in this new function to define the form-</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">display_your_form</span><span class="p">():</span>
</span><span class='line'>    <span class="n">form</span> <span class="o">=</span> <span class="n">SQLFORM</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">register</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Test</h2>

<p>Check out your amazing form at <a href="http://127.0.0.1:8000/form/default/display_your_form.html">http://127.0.0.1:8000/form/default/display_your_form.html</a>. Now, Go ahead and test the form to make sure it works. If done correctly, after you input the data and hit submit, the values are displayed.</p>

<p><img src="http://www.backwardsteps.com/uploads/2012-11-30_2330.png" alt="" /></p>

<h2>Recap</h2>

<p>We used the MVC approach to make this form:</p>

<ul>
<li><em>Model</em>: defines database table and schema</li>
<li><em>View</em>: calls the form</li>
<li><em>Controller</em>: constructs the form to be called</li>
</ul>


<p>Alright - Hold off on deploying the app for now, as we will continue to add features in the next part of this series. Pretty soon we&#8217;re going to have the best form on the Internet. Give yourself a pat on the back. You went from creating a useless &#8220;hello world&#8221; app, to creating something functional - all in less than 20 minutes!</p>

<p>You can find the code for db.py, display_your_form.html, and default.py <a href="https://github.com/mjhea0/web2py/tree/master/form%20-%20part%201">here</a>.</p>

<p>In the <a href="http://mherman.org/blog/2012/12/06/crash-course-in-web2py-part-3-form-validation/">next</a> tutorial we&#8217;ll be adding in form validation. Brace yourself.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/16/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/14/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/09/testing-angularjs-with-protractor-and-karma-part-1/">Testing AngularJS with Protractor and Karma - part 1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/06/node-with-docker-continuous-integration-and-delivery/">Node with Docker - continuous integration and delivery</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/12/postgresql-and-nodejs/">PostgreSQL and NodeJS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/05/sublime-text-for-web-developers/">Sublime Text for Web Developers</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/31/local-authentication-with-passport-and-express-4/">User Authentication with Passport and Express 4</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/analytics/'>analytics (8)</a></li>
<li class='category'><a href='/blog/categories/angular/'>angular (4)</a></li>
<li class='category'><a href='/blog/categories/crowdfunding/'>crowdfunding (1)</a></li>
<li class='category'><a href='/blog/categories/docker/'>docker (1)</a></li>
<li class='category'><a href='/blog/categories/excel/'>excel (3)</a></li>
<li class='category'><a href='/blog/categories/finance/'>finance (2)</a></li>
<li class='category'><a href='/blog/categories/frontend/'>frontend (1)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (1)</a></li>
<li class='category'><a href='/blog/categories/github/'>github (1)</a></li>
<li class='category'><a href='/blog/categories/meteor/'>meteor (1)</a></li>
<li class='category'><a href='/blog/categories/news/'>news (2)</a></li>
<li class='category'><a href='/blog/categories/node/'>node (12)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (11)</a></li>
<li class='category'><a href='/blog/categories/ruby/'>ruby (3)</a></li>
<li class='category'><a href='/blog/categories/startups/'>startups (3)</a></li>
<li class='category'><a href='/blog/categories/sublime/'>sublime (2)</a></li>

  </ul>
</section><section>
  <h1>About Me</h1>
  <p>A little something about me.</p>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Michael Herman <br/>
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, customized with <a href="https://github.com/mjhea0/whiterspace">whiterspace</a>.</span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'michaelherman';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  <script type="text/javascript" src="//s3.amazonaws.com/scripts.hellobar.com/4bda7d5a1c9bd6b6b8382efaf71e4fccbcf180ce.js"></script>
</body>
</html>
