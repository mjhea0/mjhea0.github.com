<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Python | Michael Herman]]></title>
  <link href="http://mherman.org/blog/categories/python/atom.xml" rel="self"/>
  <link href="http://mherman.org/"/>
  <updated>2017-12-01T07:10:05-07:00</updated>
  <id>http://mherman.org/</id>
  <author>
    <name><![CDATA[Michael Herman]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Flask for Node Developers]]></title>
    <link href="http://mherman.org/blog/2017/04/26/flask-for-node-developers/"/>
    <updated>2017-04-26T08:46:05-06:00</updated>
    <id>http://mherman.org/blog/2017/04/26/flask-for-node-developers</id>
    <content type="html"><![CDATA[<p><strong>Today we&rsquo;ll be going through how to build a basic CRUD server-side application using Python and <a href="http://flask.pocoo.org/">Flask</a>, geared toward JavaScript developers versed in Node and Express</strong>. Similar to <a href="https://expressjs.com/">Express</a>, <a href="http://flask.pocoo.org/">Flask</a> is a simple, yet powerful micro-framework for Python, perfect for RESTful APIs.</p>

<div style="text-align:center;">
  <img src="http://mherman.org/images/blog/flask-node.png" style="max-width: 100%; border:0; box-shadow: none;" alt="flask and node">
</div>


<p><br></p>

<blockquote><p>This tutorial uses Flask v<a href="https://pypi.python.org/pypi/Flask/0.12.1">0.12.1</a> and Python v<a href="https://www.python.org/downloads/release/python-361/">3.6.1</a>.</p></blockquote>

<h2>Contents</h2>

<ol>
<li>Objectives</li>
<li>Project Setup</li>
<li>Database Setup</li>
<li>Routes</li>
<li>Next Steps</li>
</ol>


<h2>Objectives</h2>

<p>By the end of this tutorial, you should be able to&hellip;</p>

<ol>
<li>Set up a Python development environment</li>
<li>Create and activate a virtual environment</li>
<li>Using SQLite, apply a schema to the database and interact with the database using the basic CRUD functions</li>
<li>Build a CRUD app using Python and Flask</li>
</ol>


<h2>Project Setup</h2>

<p>Before we start, ensure that you have <a href="https://www.python.org/downloads/release/python-361/">Python v3.6.1</a> installed.</p>

<p>Along with Python, we also need <a href="https://pypi.python.org/pypi/pip">pip</a> to install third-party packages from the <a href="https://pypi.python.org/pypi">Python Package Index</a> (aka PyPI), the Python equivalent of npm. Fortunately, this comes pre-installed with all Python versions >= 3.4.</p>

<p>Let&rsquo;s start by creating a new project directory:</p>

<pre><code class="sh">$ mkdir flask-songs-api &amp;&amp; cd flask-songs-api
</code></pre>

<p>Next up, we&rsquo;ll create an isolated virtual environment for installing Python packages specific to our individual project. It&rsquo;s <a href="https://www.python.org/dev/peps/pep-0405/#isolation-from-system-site-packages">standard practice</a> to set up a virtual environment for each project, otherwise there can be compatibility issues with different dependencies.</p>

<pre><code class="sh">$ python3.6 -m venv env
</code></pre>

<p>Next, we need to activate it:</p>

<pre><code class="sh">$ source env/bin/activate
</code></pre>

<p>You should now see <code>env</code> in your prompt, indicating that the virtual environment is activated.</p>

<blockquote><p><strong>NOTE:</strong> Ready to stop developing? Use the <code>deactivate</code> command to deactivate the virtual environment. To activate it again, navigate to the directory and re-run the source command - <code>source env/bin/activate</code>.</p></blockquote>

<p>Now we can install Flask:</p>

<pre><code class="sh">$ pip install Flask==0.12.1
$ pip freeze &gt; requirements.txt
</code></pre>

<p>Now is a great time to add a <em>.gitignore</em>:</p>

<pre><code>env
*.db
</code></pre>

<p>Finally, let&rsquo;s add a main app file, which will handle routing and run our application, along with a file to setup our database schema:</p>

<pre><code class="sh">$ touch app.py models.py
</code></pre>

<h2>Database Setup</h2>

<p>For this tutorial, we will be using <a href="https://www.sqlite.org/">SQLite3</a> since it&rsquo;s part of the <a href="https://docs.python.org/3.5/library/sqlite3.html">Python standard library</a>, requires little (if any) configuration, and is powerful enough for small to mid-size applications (e.g., the majority of web apps).</p>

<p>Start by creating a new database file in your project root:</p>

<pre><code class="sh">$ touch songs.db
</code></pre>

<p>Now start a new SQLite session:</p>

<pre><code class="sh">$ sqlite3 songs.db
</code></pre>

<p>Then run:</p>

<pre><code class="sh">sqlite&gt; .databases
</code></pre>

<p>You should see a file path to your database file, which is empty at the moment and ready for us to create a schema and data to. To create a schema, add the following code to <em>models.py</em>:</p>

<pre><code class="python">import sqlite3


def drop_table():
    with sqlite3.connect('songs.db') as connection:
        c = connection.cursor()
        c.execute("""DROP TABLE IF EXISTS songs;""")
    return True


def create_db():
    with sqlite3.connect('songs.db') as connection:
        c = connection.cursor()
        table = """CREATE TABLE songs(
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            artist TEXT NOT NULL,
            title TEXT NOT NULL,
            rating INTEGER NOT NULL
        );
        """
        c.execute(table)
    return True


if __name__ == '__main__':
    drop_table()
    create_db()
</code></pre>

<p>This will drop the songs table if it exists and put a new one in place with the schema we&rsquo;ve defined here. If you have any issues with your database later on, or if you just want to start fresh, you can always run this script to recreate the database. Back in the terminal, exit SQLite and then run the script to create our table:</p>

<pre><code class="sh">sqlite&gt; .exit
$ python models.py
</code></pre>

<p>Let&rsquo;s check if that actually worked:</p>

<pre><code class="sh">$ sqlite3 songs.db
sqlite&gt; .table
songs
sqlite&gt; .schema
CREATE TABLE songs(
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            artist TEXT NOT NULL,
            title TEXT NOT NULL,
            rating INTEGER NOT NULL
        );
sqlite&gt; .exit
</code></pre>

<p>Great! So, now that our database is set up correctly, we can move on to setting up our app&rsquo;s route handlers. For this post, we won&rsquo;t be going into database migrations but if you ever want to change the schema, you can use <a href="https://flask-migrate.readthedocs.io/en/latest/">Flask-Migrate</a>.</p>

<h2>Routes</h2>

<p>Let&rsquo;s start with an overview of the routes, following RESTful principles:</p>

<table>
<thead>
<tr>
<th> Endpoint              </th>
<th> Result                </th>
<th> CRUD   </th>
<th> HTTP   </th>
</tr>
</thead>
<tbody>
<tr>
<td> <code>/api/songs</code>          </td>
<td> Returns all songs     </td>
<td> Read   </td>
<td> GET    </td>
</tr>
<tr>
<td> <code>/api/song/&lt;song_id&gt;</code> </td>
<td> Returns a single song </td>
<td> Read   </td>
<td> GET    </td>
</tr>
<tr>
<td> <code>/api/songs</code>          </td>
<td> Adds a single song    </td>
<td> Create </td>
<td> POST   </td>
</tr>
<tr>
<td> <code>/api/song/&lt;song_id&gt;</code> </td>
<td> Updates a single song </td>
<td> Update </td>
<td> PUT    </td>
</tr>
<tr>
<td> <code>/api/song/&lt;song_id&gt;</code> </td>
<td> Deletes a single song </td>
<td> Delete </td>
<td> DELETE </td>
</tr>
</tbody>
</table>


<p>But first, before creating any routes, add the following code to <em>app.py</em>:</p>

<pre><code class="python">import sqlite3
from flask import Flask


app = Flask(__name__)


if __name__ == '__main__':
    app.debug = True
    app.run()
</code></pre>

<p>Here we imported <code>sqlite3</code> along with the main <a href="http://flask.pocoo.org/docs/0.12/api/#application-object">Flask application object</a>, <code>Flask</code>, which creates an instance of Flask in our application. The Flask application object acts as the central object, which we can use as a way of calling our view functions, adding our URL rules, template configuration and much more. With that instance we can run the application using the <code>run</code> <a href="http://flask.pocoo.org/docs/0.12/api/#flask.Flask.run">method</a>. We also set the <a href="http://flask.pocoo.org/docs/0.12/api/#flask.Flask.debug">debug flag</a> to <code>True</code> so that the server live reloads when code changes and provides an interactive debugger when an exception is thrown.</p>

<blockquote><p><strong>NOTE:</strong> <code>if __name__ == '__main__'</code> states that this source file is our main program. Any files imported from other modules will have their name set to their module name. This is because you may sometimes have modules that could be executed directly as well as be imported into a main app file. This line means that the code in those modules will only execute when you want to run the module as a program, and not have it execute when someone just wants to import a module and execute it themselves.</p></blockquote>

<p>Finally, it&rsquo;s important to note that any imports must go at the top of our <em>app.py</em> file. These must come before anything else in order to be used later on in our file.</p>

<p>Now, add the routes:</p>

<pre><code class="python">import sqlite3
from flask import Flask, request


app = Flask(__name__)


@app.route('/api/songs', methods=['GET', 'POST'])
def collection():
    if request.method == 'GET':
        pass  # Handle GET all Request
    elif request.method == 'POST':
        pass  # Handle POST request


@app.route('/api/song/&lt;song_id&gt;', methods=['GET', 'PUT', 'DELETE'])
def resource(song_id):
    if request.method == 'GET':
        pass  # Handle GET single request
    elif request.method == 'PUT':
        pass  # Handle UPDATE request
    elif request.method == 'DELETE':
        pass  # Handle DELETE request


if __name__ == '__main__':
    app.debug = True
    app.run()
</code></pre>

<p>We imported <code>request</code>, which handles, well, HTTP requests (no surprises there). Let&rsquo;s look at each method, staring with a POST:</p>

<h3>POST</h3>

<p>The first thing we need to do is add data to our database. Once we&rsquo;ve done this, we can start building and testing the rest of our database/CRUD functions.</p>

<p>The process is simple:</p>

<ol>
<li>Create a connection to our database</li>
<li>Execute our SQL query to add a song</li>
<li>Commit the changes to the database</li>
<li>Close the database connection</li>
<li>Return an object</li>
</ol>


<p>We can write a single function to handle this. Let&rsquo;s place all helper functions underneath the routes, to keep things nicely separated:</p>

<pre><code class="python"># helper functions

def add_song(artist, title, rating):
    try:
        with sqlite3.connect('songs.db') as connection:
            cursor = connection.cursor()
            cursor.execute("""
                INSERT INTO songs (artist, title, rating) values (?, ?, ?);
                """, (artist, title, rating,))
            result = {'status': 1, 'message': 'Song Added'}
    except:
        result = {'status': 0, 'message': 'error'}
    return result
</code></pre>

<p>Now we can just use this function in our route handler, passing the correct arguments from an incoming POST request:</p>

<pre><code class="python">@app.route('/api/songs', methods=['GET', 'POST'])
def collection():
    if request.method == 'GET':
        pass  # Handle GET all Request
    elif request.method == 'POST':
        data = request.form
        result = add_song(data['artist'], data['title'], data['rating'])
        return jsonify(result)
</code></pre>

<p>So, we grabbed the values from the incoming form request, then called the <code>add_song()</code> function to add that song to the database, and, finally, returned the appropriate JSON response.</p>

<p>Make sure to add <code>jsonify</code> to the imports in order to send a JSON response back:</p>

<pre><code class="python">from flask import Flask, request, jsonify
</code></pre>

<p>Ready to test? Start the server in one terminal window:</p>

<pre><code class="sh">$ python app.py
</code></pre>

<p>Now, in another window use CURL to send a POST request:</p>

<pre><code class="sh">$ curl --data "artist='Hudson Mohawke'&amp;title='Cbat'&amp;rating=5" http://localhost:5000/api/songs
</code></pre>

<p>If all went well, you should see the follwing response, indicating that the song was added to the database:</p>

<pre><code class="sh">{
  "message": "Song Added",
  "status": 1
}
</code></pre>

<p>Just to be on the safe side, let&rsquo;s double-check that. Kill the server, then open a SQLite session from within your project directory:</p>

<pre><code class="sh">$ sqlite3 songs.db
</code></pre>

<p>Now run the following SQL query:</p>

<pre><code class="sh">sqlite&gt; SELECT * FROM songs ORDER BY id desc;
</code></pre>

<p>You should see:</p>

<pre><code>1|'Hudson Mohawke'|'Cbat'|5`
</code></pre>

<p>Okay. We have officially added our first song! Add a couple more before moving on to reading data (GET). Don&rsquo;t forget to run the Flask server before running the CURL commands!</p>

<pre><code class="sh">$ curl --data "artist='Beastie Boys'&amp;title='Sabotage'&amp;rating=4" http://localhost:5000/api/songs
$ curl --data "artist='Gregori Klosman'&amp;title='Jaws'&amp;rating=3" http://localhost:5000/api/songs
</code></pre>

<h3>GET</h3>

<p>We&rsquo;ll start with our GET all route, e.g. - <code>api/songs</code>. We need to connect to the database, execute the appropriate SQL query, and then return all of the songs from that query:</p>

<pre><code class="python">def get_all_songs():
    with sqlite3.connect('songs.db') as connection:
        cursor = connection.cursor()
        cursor.execute("SELECT * FROM songs ORDER BY id desc")
        all_songs = cursor.fetchall()
        return all_songs
</code></pre>

<p>Next up, we have to change our route handler to now call this function and then send back JSON:</p>

<pre><code class="python">@app.route('/api/songs', methods=['GET', 'POST'])
def collection():
    if request.method == 'GET':
        all_songs = get_all_songs()
        return json.dumps(all_songs)
    elif request.method == 'POST':
        data = request.form
        result = add_song(data['artist'], data['title'], data['rating'])
        return jsonify(result)
</code></pre>

<p>Did you notice that we&rsquo;re using the <code>json</code> module? This is also from the Python standard library, which allows us to convert the &lsquo;list&rsquo;-like format of data we get back from SQLite3 into a JSON object. Just don&rsquo;t forget to import it:</p>

<pre><code class="python">import json
</code></pre>

<p>To test, we can simply navigate to <a href="http://127.0.0.1:5000/api/songs">http://127.0.0.1:5000/api/songs</a> in the browser to check if all our songs are there.</p>

<p>You should see something like:</p>

<pre><code class="json">[
  [
    3,
    "'Gregori Klosman'",
    "'Jaws'",
    3
  ],
  [
    2,
    "'Beastie Boys'",
    "'Sabotage'",
    4
  ],
  [
    1,
    "'Hudson Mohawke'",
    "'Cbat'",
    5
  ]
]
</code></pre>

<p>Now that we can GET all songs, let&rsquo;s build a function to GET just a single song. This function will take a parameter of <code>song_id</code>, create a connection to our database, find that song with a SQL query, and then return that song with JSON:</p>

<pre><code class="python">def get_single_song(song_id):
    with sqlite3.connect('songs.db') as connection:
        cursor = connection.cursor()
        cursor.execute("SELECT * FROM songs WHERE id = ?", (song_id,))
        song = cursor.fetchone()
        return song
</code></pre>

<p>We can update our route with a <code>song_id</code> as a parameter, and send back the single song:</p>

<pre><code class="py">@app.route('/api/song/&lt;song_id&gt;', methods=['GET', 'PUT', 'DELETE'])
def resource(song_id):
    if request.method == 'GET':
        song = get_single_song(song_id)
        return json.dumps(song)
    elif request.method == 'PUT':
        pass  # Handle UPDATE request
    elif request.method == 'DELETE':
        pass  # Handle DELETE request
</code></pre>

<p>If you now point your browser to <a href="http://127.0.0.1:5000/api/song/2">http://127.0.0.1:5000/api/song/2</a> you should see the JSON object for our song with an id of <code>2</code> in the database:</p>

<pre><code class="json">[
    2,
    "'Beastie Boys'",
    "'Sabotage'",
    4
]
</code></pre>

<p>If you try to put in an id that we don&rsquo;t have in the database currently, you will just get <code>null</code> displayed on the page instead of a JSON object.</p>

<p>We can CREATE a song, READ all songs, and READ a single song. Only two more routes to go&hellip;</p>

<h3>PUT</h3>

<p>A major function that we&rsquo;re missing is the ability to edit data that&rsquo;s already present in our database. We do this using a PUT request by taking incoming data with an id passed through the URL, finding the object in our database with that particular id, and then updating it.</p>

<p>Let&rsquo;s start with an edit function, which takes in the song id, artist, title, and rating as arguments:</p>

<pre><code class="python">def edit_song(song_id, artist, title, rating):
    try:
        with sqlite3.connect('songs.db') as connection:
            connection.execute("UPDATE songs SET artist = ?, title = ?, rating = ? WHERE ID = ?;", (artist, title, rating, song_id,))
            result = {'status': 1, 'message': 'SONG Edited'}
    except:
        result = {'status': 0, 'message': 'Error'}
    return result
</code></pre>

<p>Now we can edit our route to pass in the data from the PUT request:</p>

<pre><code class="py">@app.route('/api/song/&lt;song_id&gt;', methods=['GET', 'PUT', 'DELETE'])
def resource(song_id):
    if request.method == 'GET':
        song = get_single_song(song_id)
        return json.dumps(song)
    elif request.method == 'PUT':
        data = request.form
        result = edit_song(
            song_id, data['artist'], data['title'], data['rating'])
        return jsonify(result)
    elif request.method == 'DELETE':
        pass  # Handle DELETE request
</code></pre>

<p>So if we test this route out with CURL:</p>

<pre><code class="sh">$ curl -X PUT --data "artist='Van Halen'&amp;title='Hot for Teacher'&amp;rating=3" localhost:5000/api/song/2
</code></pre>

<p>We should see:</p>

<pre><code class="sh">{
  "message": "SONG Edited",
  "status": 1
}
</code></pre>

<p>We can (err, should) make sure that edit is reflected in the database:</p>

<pre><code class="sh">$ sqlite3 songs.db
sqlite&gt; SELECT * FROM songs ORDER BY id desc;

3|'Gregori Klosman'|'Jaws'|3
2|'Van Halen'|'Hot for Teacher'|3
1|'Hudson Mohawke'|'Cbat'|5
</code></pre>

<p>We can edit songs at will!</p>

<h3>Delete</h3>

<p>The last thing we have left to do is our DELETE route. We need to be able to remove data from our database. Let&rsquo;s first add in a song we can then delete using CURL in the terminal:</p>

<pre><code class="sh">$ curl --data "artist='The Flaming Lips'&amp;title='Buggin'&amp;rating=2" http://localhost:5000/api/songs
</code></pre>

<p>Make sure it&rsquo;s in our database:</p>

<pre><code class="sh">$ sqlite3 songs.db
sqlite&gt; SELECT * FROM songs ORDER BY id desc;

4|'The Flaming Lips'|'Buggin'|2
3|'Gregori Klosman'|'Jaws'|3
2|'Van Halen'|'Hot for Teacher'|3
1|'Hudson Mohawke'|'Cbat'|5
</code></pre>

<p>We need to build a delete function:</p>

<pre><code class="python">def delete_song(song_id):
    try:
        with sqlite3.connect('songs.db') as connection:
            connection.execute("DELETE FROM songs WHERE ID = ?;", (song_id,))
            result = {'status': 1, 'message': 'SONG Deleted'}
    except:
        result = {'status': 0, 'message': 'Error'}
    return result
</code></pre>

<p>And now let&rsquo;s add in our delete route:</p>

<pre><code class="py">@app.route('/api/song/&lt;song_id&gt;', methods=['GET', 'PUT', 'DELETE'])
def resource(song_id):
    if request.method == 'GET':
        song = get_single_song(song_id)
        return json.dumps(song)
    elif request.method == 'PUT':
        data = request.form
        result = edit_song(
            song_id, data['artist'], data['title'], data['rating'])
        return jsonify(result)
    elif request.method == 'DELETE':
        result = delete_song(song_id)
        return jsonify(result)
</code></pre>

<p>Test it with CURL:</p>

<pre><code class="sh">$ curl -X DELETE localhost:5000/api/song/4

{
  "message": "SONG Deleted",
  "status": 1
}
</code></pre>

<p>And finally, go back into our database and really make sure it&rsquo;s gone:</p>

<pre><code class="sh">$ sqlite3 songs.db
sqlite&gt; SELECT * FROM songs ORDER BY id desc;

3|'Gregori Klosman'|'Jaws'|3
2|'Van Halen'|'Hot for Teacher'|3
1|'Hudson Mohawke'|'Cbat'|5
</code></pre>

<p>Boom! So we now have all of our routes doing <em>exactly</em> what we want them to do. We can add songs, get the songs back (all, or just a single song), edit a song, and remove a song. That&rsquo;s some quality CRUD right there.</p>

<h2>Next Steps</h2>

<ol>
<li><em>Error Handling</em>: The code we have right now is completely reliant on the data coming through correctly, but what if there&rsquo;s something missing when the user sends a POST request? For example, what would happen if the artist name was missing? Right now we aren&rsquo;t handling errors that may come up. Think about how we can send information back to the user if not all fields are present in the POST or PUT request, and how you could be clear in the error messages we send back to the user.</li>
<li><em>Server-side Templating</em>: Build out your client-side by adding <a href="http://flask.pocoo.org/docs/0.12/quickstart/#static-files">static files</a> and <a href="http://flask.pocoo.org/docs/0.12/quickstart/#rendering-templates">templates</a>.</li>
<li><em>Database Management:</em> Refactor SQLite and vanilla SQL out of your application and add in Postgres, <a href="http://flask-sqlalchemy.pocoo.org/2.1/">Flask-SQLAlchemy</a> (for communicating with the database), and <a href="https://flask-migrate.readthedocs.io/en/latest/">Flask-Migrate</a> (for migrations). Check out <a href="https://github.com/mjhea0/flask-songs-api/tree/master/_live">this example</a> of how to use Postgres and Flask-SQLAlchemy.</li>
</ol>


<p>Grab the code from the <a href="https://github.com/mjhea0/flask-songs-api">flask-songs-api</a> repo. Cheers!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Custom Apache Config for PHP and Web2Py]]></title>
    <link href="http://mherman.org/blog/2013/08/25/custom-apache-config-for-php-and-web2py/"/>
    <updated>2013-08-25T15:34:00-06:00</updated>
    <id>http://mherman.org/blog/2013/08/25/custom-apache-config-for-php-and-web2py</id>
    <content type="html"><![CDATA[<h2>Problem</h2>

<p>As you probably know, the web2py admin must be hosted on a secured domain. We set a client up with a basic CRM system under the domain <a href="http://crm.maindomain.com,">http://crm.maindomain.com,</a> which worked perfectly until a GeoTrust SSL Certificate was installed.</p>

<p>Since the purchased GeoTrust certificate was just for a single domain, there was no way to access the web2py admin unless another dedicated IP address was purchased - which the site owner did not want to pay for.</p>

<p>Fortunately, there is a work around.</p>

<h2>Solution</h2>

<p>After hours of research/tests, the identified solution was to configure the web2py application, as well as the admin, under the main domain:</p>

<ul>
<li>App: <a href="https://maindomain.com/crm">https://maindomain.com/crm</a></li>
<li>Admin: <a href="https://maindomain.com/crm/admin">https://maindomain.com/crm/admin</a></li>
</ul>


<p>Essentially, any URL pattern that fell under /crm/ would be served by web2py, while all other URLS would be served by an existing Joomla application.</p>

<h2>Steps</h2>

<ol>
<li>Transfer the apache SSL configuration from the current crm domain (crm.mainpage.com) to the main domain (mainpage.com):</li>
</ol>


<pre><code class="sh"># mv /usr/local/apache/conf/userdata/ssl/2/main/crm.maindomain.com /usr/local/apache/conf/userdata/ssl/2/main/maindomain.com
</code></pre>

<ol>
<li>Update the apache config <code>/usr/local/apache/conf/userdata/ssl/2/main/maindomain.com/wsgi.conf</code>:</li>
</ol>


<pre><code class="sh">ServerName maindomain.com
ServerAlias crm.maindomain.com www.maindomain.com

WSGIScriptAlias /crm /home/main/python/maindomain.com/app/app.wsgi
</code></pre>

<blockquote><p>Note: Make sure to also comment out &lsquo;UserDir disabled&rsquo; and all apache Rewrite lines</p></blockquote>

<ol>
<li>Update web2py routing configuration, <code>/home/main/python/maindomain.com/app/web2py/routes.py</code>:</li>
</ol>


<pre><code class="python">routers = dict(
    BASE = dict(
    default_application='CRM',
    path_prefix='crm',
    )
)
</code></pre>

<ol>
<li>Rebuild apache config:</li>
</ol>


<pre><code class="sh"># /scripts/rebuildhttpdconf
</code></pre>

<ol>
<li>Restart apache:</li>
</ol>


<pre><code class="sh"># /scripts/restartsrv_httpd
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Removing a Django App]]></title>
    <link href="http://mherman.org/blog/2013/07/04/removing-a-django-app/"/>
    <updated>2013-07-04T09:43:00-06:00</updated>
    <id>http://mherman.org/blog/2013/07/04/removing-a-django-app</id>
    <content type="html"><![CDATA[<p>In order to completely uninstall a Django application you have to not only delete the database tables - but you also need to remove the related <a href="https://docs.djangoproject.com/en/1.5/ref/contrib/contenttypes/">contenttypes</a>.</p>

<p>Let&rsquo;s look at two ways to handle this: Manually and with <a href="http://south.aeracode.org/">South</a>.</p>

<p>In this case, the application name is called <code>customers</code>, and it contains the following tables within <em>models.py</em>:</p>

<pre><code class="python">class Student(models.Model):
    name = models.CharField(max_length=30)
    courses = models.ManyToManyField('Course')

    def __unicode__(self):
        return self.name

class Course(models.Model):
    name = models.CharField(max_length=30)

    def __unicode__(self):
        return self.name
</code></pre>

<p>Also, I am using a sqlite3 database called <em>test.db</em>, which contains <a href="https://gist.github.com/mjhea0/5959729">this</a> data.</p>

<p>Let&rsquo;s say we want to drop the Course table (for reasons unknown).</p>

<h2>Manually</h2>

<ol>
<li>Navigate to your project working directory and drop the table:</li>
</ol>


<pre><code class="python">$ python manage.py sqlclear customers &gt; drop_customers_customerprofile
</code></pre>

<ol>
<li><p>Remove the app from the INSTALLED_APPS section in <em>settings.py</em> and delete any associated URL patterns from <em>urls.py</em>.</p></li>
<li><p>Drop the database tables:</p></li>
</ol>


<pre><code class="python">$ sqlite3 test.db
sqlite&gt; DROP TABLE customers_customerprofile;
</code></pre>

<blockquote><p>equivalent MySQL command - <code>$ mysql -u root -p &lt;database_name&gt; &lt; drop_&lt;app_name&gt;_&lt;table_name&gt;.sql</code></p></blockquote>

<ol>
<li>Clean up the related contenttypes from the Shell:</li>
</ol>


<pre><code class="python">$ python manage.py shell
&gt;&gt;&gt; from django.contrib.contenttypes.models import ContentType
&gt;&gt;&gt; ContentType.objects.filter(app_label='customers').delete()
</code></pre>

<ol>
<li>You can now delete the app folder as well as any associated media files and/or templates. Finally, make sure to uninstall any associated packages or dependencies using <code>pip uninstall &lt;package_name&gt;</code>. <em>Make sure to use virtualenv</em>.</li>
</ol>


<h2>South</h2>

<p>I use South with all my Django projects, so I tend to prefer this method. Let&rsquo;s take a look.</p>

<ol>
<li>Setup the initial migration and push it through:</li>
</ol>


<pre><code class="python">$ python manage.py schemamigration customers --initial
$ python manage.py migrate customers
</code></pre>

<ol>
<li><p>Remove the <code>CustomerProfile</code> class from <em>models.py</em>.</p></li>
<li><p>Setup the migration to delete the table:</p></li>
</ol>


<pre><code class="sh">$ python manage.py schemamigration customers --auto
</code></pre>

<ol>
<li>Update the migration file <em>0002_auto__del_customerprofile.py</em>, to clean up the related contenttypes as well as delete the table from the database, by updating the <code>forwards</code> function:</li>
</ol>


<pre><code class="python">def forwards(self, orm):
   # Deleting model 'CustomerProfile'
   db.delete_table(u'customers_customerprofile')
   from django.contrib.contenttypes.models import ContentType
   ContentType.objects.filter(app_label='customers').delete()
</code></pre>

<ol>
<li>Push the migration through:</li>
</ol>


<pre><code class="sh">$ python manage.py migrate customers
</code></pre>

<ol>
<li>Fake a zero migration to remove the migration history and clear up the South tables:</li>
</ol>


<pre><code class="sh">$ python manage.py migrate customers zero --fake
</code></pre>

<ol>
<li>Remove the app from the INSTALLED_APPS section in <em>settings.py</em> and delete any associated URL patterns from <em>urls.py</em>. Then delete the app folder and any related media files and/or templates. Finally, make sure to uninstall any packages or dependencies using <code>pip unistall &lt;package_name&gt;</code>. <em>Make sure to use virtualenv</em>.</li>
</ol>


<p><strong>Comment if you have questions. Cheers!</strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Django Basics - Installing Django and Setting Up a Project and App]]></title>
    <link href="http://mherman.org/blog/2012/12/30/django-basics/"/>
    <updated>2012-12-30T09:48:00-07:00</updated>
    <id>http://mherman.org/blog/2012/12/30/django-basics</id>
    <content type="html"><![CDATA[<p>This brief tutorial shows the basics of installing and setting up a simple app in Django that is used to submit and retrieve information about books you&rsquo;ve read:</p>

<ul>
<li>Part 1 - Installing and Setting up Django</li>
<li>Part 2 - Creating the Database Model</li>
<li>Part 3 - Django API vs Admin site</li>
<li>Part 4 - Django Templates and Views</li>
</ul>


<p>Each part includes an accompanying video. You can download the source via Github - which includes all four parts. I will be delivering this tutorial from a Windows-perspective, but the Mac OS X perspective is pretty much the same.</p>

<p>This tutorial follows the first few sections of the official Django tutorial.</p>

<p>Videos - <a href="http://www.youtube.com/watch?v=ZgfGdRYVXjw">Part 1</a>, <a href="http://www.youtube.com/watch?v=aHLQpo3UHek">Part 2</a>, <a href="http://www.youtube.com/watch?v=SEV9Adp-AFQ">Part 3</a>, <a href="http://www.youtube.com/watch?v=_cPM7CgG-Fc">Part 4</a></p>

<p>GitHub - <a href="https://github.com/mjhea0/django-tutorial">https://github.com/mjhea0/django-tutorial</a></p>

<p><strong>Django?</strong></p>

<p>Developed in 1995 Django is one of, if not the most, popular Python web frameworks. It promotes rapid development via the model-view-controller architecture. You can learn more about it <a href="https://www.djangoproject.com/">here</a>.</p>

<p><strong>Prerequisites:</strong></p>

<ul>
<li>You have Python 2.7 installed.</li>
<li>You have PIP installed. To install, you need to first install setup tools. Click <a href="http://www.youtube.com/watch?v=ssQAFIQ4oBU">here</a> for a brief tutorial on how to do that. Then you can just run the command <code>easy_install pip</code> from the command prompt to install PIP.</li>
</ul>


<hr />

<p><em>Alright let&rsquo;s get started &hellip;</em></p>

<h2><strong>Part 1 - Installing Django</strong></h2>

<h3>Open the command prompt with admin privileges and run the command-</h3>

<pre><code class="python">pip install Django
</code></pre>

<p>   -to install Django into your site-packages directory.</p>

<h3>To setup, you need to create a new project. Within command prompt, navigate to the directory you wish to create the new project, then run the command -</h3>

<pre><code class="sh">python C:\Python27\Lib\site-packages\django\bin\django-admin.py startproject testproject
</code></pre>

<p>   Your path to <em>django-admin.py</em> may be different, so make sure to tailor it if necessary. Also, <em>testproject</em> is the name of the created project. Feel free to name this whatever you like.</p>

<h3>Next you need to make sure everything was setup correctly. To do that, you can launch the Django server. First, navigate to your newly created directory (<em>testproject</em>, in my case), and then run the command-</h3>

<pre><code class="sh">python manage.py runserver
</code></pre>

<p>   Open up a new browser window and navigate to <a href="http://localhost:8000/.">http://localhost:8000/.</a> If setup correctly, you will see the Welcome to Django screen.</p>

<h3>Let&rsquo;s setup the database. Open up <em>settings.py</em> in the <em>testproject</em> directory with a text editor. (I use Notepad++.) Append <em>sqlite3</em> to the end of the Engine key and then add the path to the name key. You can name the database whatever you’d like because if the database doesn’t exist, Django will create it for you in the next step. The results should look like something similar to this (depending upon your path)-</h3>

<pre><code class="python">'ENGINE': 'django.db.backends.sqlite3',
'NAME': 'C:/Python27/django/testproject/test.db',
</code></pre>

<p>   (Yes, use forward slashes.)</p>

<h3>Finally, you need to create and then sync the database by navigating to the directory where <em>manage.py</em> is located (should be the project&rsquo;s main directory) and then running the following command-</h3>

<pre><code class="sh">python manage.py syncdb
</code></pre>

<p>   Create a superuser. I used <em>admin</em> for both my username and password.</p>

<p>Alright, the setup is complete. You&rsquo;re now ready to start creating an app.</p>

<h2><strong>Part 2 - Creating the Database Model</strong></h2>

<h3>Start by creating an app. Within command prompt, navigate to the <em>testproject</em> directory and then type the command-</h3>

<pre><code class="sh">python manage.py startapp books
</code></pre>

<p>   CD into the directory. You should see a <em>models.py</em> file. This file is used to setup the entities and attributes for your database.</p>

<h3>Go ahead and open <em>models.py</em> in Notepad++ and add in the following code:</h3>

<pre><code class="python">class Books(models.Model):
    title = models.CharField(max_length=150)
    author = models.CharField(max_length=100)
    read = models.CharField(max_length=3)
</code></pre>

<p>   This code should be relatively clear. This class defines the database fields- title, author, and read. The data in the read field will either be &ldquo;yes&rdquo; or &ldquo;no&rdquo; depending on whether you&rsquo;ve read the book or not.</p>

<p>   Since there is only one table, we don&rsquo;t need to establish a foreign key. The primary key, a unique id, will be automatically generated for us by Django&rsquo;s magic.</p>

<p>   Save the file.</p>

<h3>Now open up the <em>settings.py</em> file, scroll down to <em>Installed Apps</em> and add the app name, <em>books</em>, to the installed apps so that Django knows to include it. Your installed apps section should look like this-</h3>

<pre><code class="python">INSTALLED_APPS = (
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.sites',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'books',
    # Uncomment the next line to enable the admin:
    # 'django.contrib.admin',
    # Uncomment the next line to enable admin documentation:
    # 'django.contrib.admindocs',
)
</code></pre>

<p>   Save the file.</p>

<h3>CD back to the main project directory and run the command-</h3>

<pre><code class="sh">python manage.py sql books
</code></pre>

<p>   -to display the actual SQL statements for creating the table. Did you notice the primary key?</p>

<p>   Your output should look like this-</p>

<pre><code class="python">BEGIN;
CREATE TABLE "books_books" (
    "id" integer NOT NULL PRIMARY KEY,
    "title" varchar(150) NOT NULL,
    "author" varchar(100) NOT NULL,
    "read" varchar(3) NOT NULL
)
;
COMMIT;
</code></pre>

<p>   You can also use the following command to check to see if there are any errors in your models-</p>

<pre><code class="sh">python manage.py validate
</code></pre>

<h3>Finally, you need to run the following command to execute the SQL statements:</h3>

<pre><code class="sh">python manage.py syncdb
</code></pre>

<p>Next, I&rsquo;ll show you how to access the Django API to add data to the database.</p>

<h2><strong>Part 3 - Django API vs Admin site</strong></h2>

<h3>First open up command prompt, navigate to your project directory, and then run the command-</h3>

<pre><code class="sh">python manage.py shell
</code></pre>

<p>   This opens an interactive environment for us to use.</p>

<h3>Next go ahead and import your app with the following command-</h3>

<pre><code class="python">from books.models import Books
</code></pre>

<h3>There&rsquo;s a number of different things you can do within this environment, but let&rsquo;s stick with adding data to our database. To add a row, run this command-</h3>

<pre><code class="python">b = Books(title="To Kill a Mockingbird", author="Harper Lee", read="yes")
b.save()
b = Books(title="Brave New World", author="Aldous Huxley", read="yes")
b.save()
b = Books(title="War and Peace", author="Leo Tolstoy", read="no")
b.save()
</code></pre>

<p>Go ahead and add as many books as you&rsquo;d like for practice.</p>

<p>Once complete, you can view the data in your database in a number of ways. I like to just use SQLite, which can be downloaded <a href="http://sourceforge.net/projects/sqlitebrowser/">here</a>. So, go ahead and open the text.db file which is located within your project&rsquo;s main directory, switch to the <em>Browse Data</em> tab, and then under the Table dropdown choose <em>books_books</em>. You should see all the books you added.</p>

<p>You can exit the Django interactive environment using the <code>exit()</code> command.</p>

<p>Okay, let&rsquo;s look at an even easier means of adding data using <strong>Django&rsquo;s admin site</strong>.</p>

<h3>Open the <em>settings.py</em> file, scroll down to <em>Installed Apps</em> and uncomment the line <em>&lsquo;django.contrib.admin&rsquo;,</em>. Then save the file.</h3>

<h3>Update the database by running the command-</h3>

<pre><code class="sh">python manage.py syncdb
</code></pre>

<h3>Next open the <em>urls.py</em> file within the <em>books</em> directory. You need to uncomment these three lines-</h3>

<pre><code class="python">from django.contrib import admin
admin.autodiscover()
url(r'^admin/', include(admin.site.urls)),
</code></pre>

<p>   Save the file and exit.</p>

<h3>Now create a new file in your <em>books</em> directory called <em>admin.py</em> and add the following code to the file-</h3>

<pre><code class="python">from books.models import Books
from django.contrib import admin
admin.site.register(Books)
</code></pre>

<h3>Next, open up your <em>models.py</em> file and add these two lines of code-</h3>

<pre><code class="python">def __unicode__(self):
    return self.title + " / " + self.author + " / " + self.read
</code></pre>

<p>   Essentially, <em>self</em> refers to the current object.</p>

<h3>Now start the development server - <code>python manage.py runserver</code>, point your browser to <a href="http://localhost:8000/admin,">http://localhost:8000/admin,</a> and enter your login credentials. You should see the <em>Books</em> app. And if you click the app, you should now see the data we added earlier.</h3>

<p>   Go ahead and add a few more books in. Try deleting a row as well. See how much easier that is in the Admin console?</p>

<p>So we&rsquo;re done with the Admin console. Hit CTRL+BREAK to exit. I&rsquo;m also done showing you how to create and modify your app&rsquo;s model(s). Next, we&rsquo;ll look at how to modify what the user sees (views and templates).</p>

<h2><strong>Part 4 - Django Templates and Views</strong></h2>

<p>Again, in this final tutorial I&rsquo;ll go over how to create the public interface.</p>

<h3>The first thing we need to do is setup the URL structure. Open up <em>urls.py</em> and then add this code to the <em>urlpatterns</em>-</h3>

<pre><code class="python">url(r'^books/$', 'books.views.index'),
</code></pre>

<p>   This is essentially a tuple that points a user to a Django page based on the URL that user visits. In this case the regular expression dictates that when the user visits any page with the ending /books they will be see the books.views.index page. This is a bit complicated, so be sure to visit the Django <a href="https://docs.djangoproject.com/en/1.4/intro/tutorial03/">tutorial</a> for more into.</p>

<h3>Now to ensure that this is setup correctly run the server and then point your browser to <a href="http://localhost:8000/books.">http://localhost:8000/books.</a></h3>

<p>   As long as you get the error, <em>ViewDoesNotExist at /books</em>, then the url is setup correctly.</p>

<p>   We need to actually write the view now.</p>

<h3>Stop the server (CRTL+BREAK) and then within the <em>books</em> directory open <em>views.py</em> in Notepad++ and write the following code to test out your views-</h3>

<pre><code class="python">from django.http import HttpResponse
def index(request):
    return HttpResponse("Hello. This is a test.")
</code></pre>

<p>   Save the file. Run the server. And refresh the page. You should no longer see an error. Instead, you should just see a page with the words <em>Hello. This is a test.</em> in the top corner.</p>

<h3>Okay, now let&rsquo;s display something a bit more meaningful - like a listing of all the books in the database. To do that, you need your <em>views.py</em> file to look like this-</h3>

<pre><code class="python">from django.http import HttpResponse
from books.models import Books
def index(request):
    books_list = Books.objects.all()
    return HttpResponse(books_list)
</code></pre>

<p>-and then just hit refresh on your browser. (Remember: we didn&rsquo;t stop the server).</p>

<p>   You should see all of the books in one long line. It looks bad, but it works.</p>

<p>Next, we&rsquo;re going to work with <strong>templates</strong>, which will allow us to easily create a much more readable output.</p>

<h3>Start by making a new directory in the django directory, outside of the project, called <em>templates</em>. Within that directory, make a directory called <em>books</em>.</h3>

<h3>Next open up <em>settings.py</em>, scroll down to <em>TEMPLATE_DIRS</em> and add the template directory-</h3>

<pre><code class="python">"C:/Python27/django/templates"
</code></pre>

<p>   Yes, those are forward slashes.</p>

<h3>Now create a new file in your <em>temples\books</em> directory. Save it as index.html and add the following code-</h3>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;h1&gt;</span>My Fab Book Collection<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>{% if books_list %}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;ul&gt;</span>
</span><span class='line'>{% for b in books_list %}
</span><span class='line'>    <span class="nt">&lt;li&gt;</span>{{b.title}} | {{b.author}} | {{b.read}}<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>{% endfor %}
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>{% endif %}
</span></code></pre></td></tr></table></div></figure></p>

<h3>Open <em>views.py</em> again and make it looks like this-</h3>

<pre><code class="python">from django.http import HttpResponse
from books.models import Books
from django.template import Context, loader
def index(request):
    books_list = Books.objects.all()
    t = loader.get_template('books/index.html')
    c = Context({'books_list': books_list,})
    return HttpResponse(t.render(c))
</code></pre>

<p>Basically, the loader is the path to the template we created, which then gets assigned to the Python object via the Context dictionary.</p>

<h3>Save the file. Run the server. Refresh the <a href="http://localhost:8000/books">http://localhost:8000/books</a> page. There&rsquo;s the books. Looks a little better, too.</h3>

<p>I know I said that I&rsquo;d show to make it so a non-administrator can add data to the database - but I just realized that this would be another lesson in itself. So, I&rsquo;m going to stop here. Feel free to view the Django Tutorial to learn how to add that functionality to your application.</p>

<p>In fact, the whole point to these tutorials is for you to get started with the Django tutorial. I bounced around a bit but I hope that you can now go through the tutorial a bit easier now that you have a starting off point.</p>

<p>Thanks for watching. See you next time.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Crash Course in Web2py (Part 5 - Modifying the Appearance and Deploying the Web Form)]]></title>
    <link href="http://mherman.org/blog/2012/12/10/crash-course-in-web2py-part-5-modifying-the-appearance-and-deploying-the-web-form/"/>
    <updated>2012-12-10T07:39:00-07:00</updated>
    <id>http://mherman.org/blog/2012/12/10/crash-course-in-web2py-part-5-modifying-the-appearance-and-deploying-the-web-form</id>
    <content type="html"><![CDATA[<p>You made it. In this final tutorial I&rsquo;ll show you how to easily modify the form&rsquo;s appearance, and we&rsquo;ll deploy the app to PythonAnywhere.</p>

<p><em>Assumptions:</em></p>

<ol>
<li>You have web2py already installed => <a href="http://mherman.org/blog/2012/11/27/crash-course-in-web2py-part-1/">part 1</a></li>
<li>You created the skeleton web form => <a href="http://mherman.org/blog/2012/12/01/crash-course-in-web2py-part-2-web-forms/">part 2</a></li>
<li>You added data validation (with the help of Han Solo) => <a href="http://mherman.org/blog/2012/12/06/crash-course-in-web2py-part-3-form-validation/">part 3</a></li>
<li>You learned how to easily add CRUD functions to manage records => <a href="http://mherman.org/blog/2012/12/09/crash-course-in-web2py-part-4-managing-form-records/">part 4</a></li>
</ol>


<p>Let&rsquo;s get going &hellip;</p>

<p>Launch the server. -> Go to the admin interface. -> Edit the &ldquo;form&rdquo; application.</p>

<p>So, by default web2py utilizes the <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a> front-end framework, which makes updating the layout and appearance easy.</p>

<h2>Download New Layout Plugin</h2>

<p>First, go to the web2py layout plugin <a href="http://web2py.com/layouts">page</a> to find a layout that you like. In this example, I used <a href="http://web2py.com/layouts/static/plugin_layouts/layouts/KeepitSimple/index.html">KeepitSimple</a>. Once you find one, go ahead and download the .w2p file.</p>

<p>Back on the admin page for the form, scroll to the bottom of the page, and upload the .w2p file beneath the Plugins section. Now, click the link for plugin_layouts and copy the name of the new file including the full path- <em>plugin_layouts/layouts/KeepitSimple.html</em>. Now, edit the display_your_form.html file and paste the new .html file in the very first line of the code, replacing layout.html-</p>

<p><img src="http://www.backwardsteps.com/uploads/2012-12-09_2303.png" alt="" /></p>

<p>Next, I&rsquo;m going to remove the <em>Web Form</em> title between the h1 tags, remove the line breaks, and clean up the instructions. I&rsquo;m also going to remove the <em>Submitted</em>, <em>Accepted</em>, and, <em>Errors</em>  sections, as the user does not need to see all that information. So the final code looks like this:</p>

<p>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{{extend <span class="ni">&amp;lsquo;</span>plugin_layouts/layouts/KeepitSimple.html<span class="ni">&amp;rsquo;</span>}}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>Please enter your first name, last name, and email address - thanks!<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;h2&gt;</span>Inputs:<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>{{=form}}
</span></code></pre></td></tr></table></div></figure>
</p>

<p>Okay, now let&rsquo;s edit the <em>KeepitSimple html</em> file:</p>

<p>First change the header div found in the middle of the page - &ldquo;Welcome. Please register to access your services.&rdquo; (I also surrounded it in <code>&lt;center&gt;</code> tags)</p>

<p>Add the following code to the header, just below the style.css -</p>

<p>
<code>html
{{response.files.append(URL(request.application,'static','css/bootstrap.min.css'))}}
</code>
</p>

<p>Then remove these lines of code-</p>

<p>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{{try:}}{ {=auth.navbar(action=URL(<span class="ni">&amp;lsquo;</span>default<span class="ni">&amp;rsquo;</span>,<span class="ni">&amp;lsquo;</span>user<span class="ni">&amp;rsquo;</span>))}}{{ except:pass}}
</span><span class='line'>{{=MENU(response.menu,_class=<span class="ni">&amp;lsquo;</span>web2py-menu<span class="ni">&amp;rsquo;</span>)}}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;copy;</span>2007 Keep it Simple <span class="ni">&amp;nbsp;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;separator&quot;</span>
</span><span class='line'><span class="err">|</span>
</span><span class='line'><span class="err">&lt;/</span><span class="na">span</span><span class="nt">&gt;</span>
</span><span class='line'><span class="ni">&amp;nbsp;</span> Design by
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://www.realitysoftware.ca&quot;</span> <span class="na">title=</span><span class="s">&quot;Website Design&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>Reality Software
</span><span class='line'><span class="nt">&lt;/a&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span>
</span><span class='line'>
</span><span class='line'>## Update CSS
</span><span class='line'>
</span><span class='line'>Your form should look much cleaner now. It&#39;s a bit bare, but you can liven it up with your own HTML. Now, let&#39;s add some changes to the CSS.
</span><span class='line'>
</span><span class='line'>Again, since web2py uses the Twitter Bootstrap, you can make CSS changes quickly. Navigate to [Bootswatch](http://bootswatch.com/). Here, you can find various CSS themes to play with. In this example, I&#39;m going to use Spacelab.
</span><span class='line'>
</span><span class='line'>Now, what you need to do is view the *bootstrap.min.css* file by clicking download and then selecting the file. It should open in your browser. Copy all the text. Return to your web2py admin. Scroll down to the static files, click the CSS folder, edit the boootstrap.min.css file-
</span><span class='line'>
</span><span class='line'>![](http://www.backwardsteps.com/uploads/2012-12-10_0824.png)
</span><span class='line'>
</span><span class='line'>-and then delete all the current CSS and paste in the CSS that you copied before from the Spacelab theme. Refresh your form @ [http://127.0.0.1:8000/form/default/display_your_form.html](http://127.0.0.1:8000/form/default/display_your_form.html) and test it again to make sure nothing broke.
</span><span class='line'>
</span><span class='line'>Oh - and if you want, you can edit the layout/appearance of the all_records page as well. I trust that you can figure out how to do that by now. If not - Try anyway, and if you fail, Google to find the answer. You&#39;ll learn better that way.
</span><span class='line'>
</span><span class='line'>If all looks well, it&#39;s time to deploy!
</span><span class='line'>
</span><span class='line'>## Deploy
</span><span class='line'>
</span><span class='line'>I&#39;ll go over this quick since I covered this in [detail](http://mherman.org/blog/2012/11/27/crash-course-in-web2py-part-1/) in the first tutorial.
</span><span class='line'>
</span><span class='line'>1. Go back to the admin page ([http://127.0.0.1:8000/admin/default/site](http://127.0.0.1:8000/admin/default/site)) and click Pack All. Save the w2p-package to your computer.
</span><span class='line'>1. Fire up [PythonAnywhere](https://www.pythonanywhere.com/).
</span><span class='line'>1. Once logged in, click *Web*, *Replace with a new web app*, then click the button for web2py.
</span><span class='line'>1. Enter an admin password. Click Next.
</span><span class='line'>1. Next, head on over to the admin interface - https://mjhea9.pythonanywhere.com/admin/default/index (don&#39;t forget to use your own user name and add the https:) - which should look familiar (it better!). Enter your password.
</span><span class='line'>1. On the right side of the page, under the *Upload and install packed application section*, upload the w2p file you saved. Enter a name for your app (&quot;form&quot;). Click Install.
</span><span class='line'>1. Check out your form. You can view mine at - [https://mjhea9.pythonanywhere.com/form/default/display_your_form.html](https://mjhea9.pythonanywhere.com/form/default/display_your_form.html)
</span><span class='line'>
</span><span class='line'>![](http://www.backwardsteps.com/uploads/2012-12-10_0917.png)
</span><span class='line'>
</span><span class='line'>Now just test it out to make sure it all works. Make sure all the errors/validators are working and then add a new record. One thing you do need to change is the default for generic view. You can read more about it [here](http://web2py.com/books/default/chapter/29/10#Generic-views). Open up db.py and scroll down to line 28. You need to remove the if statement, so the line will look just like this:
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>response.generic_patterns = [<span class="ni">&amp;lsquo;</span>*<span class="ni">&amp;rsquo;</span>]
</span></code></pre></td></tr></table></div></figure></p>

<p>Now, make sure you can access the <em>grid</em> page - <a href="https://mjhea9.pythonanywhere.com/form/default/all_records">https://mjhea9.pythonanywhere.com/form/default/all_records</a> - and edit, update, and delete some records.</p>

<p>One change that does need to be made is to add the requirement <em>IS_EMAIL()</em> to the email validation field to the db.py file; otherwise, you can submit email addresses that do not follow the conventional format. The final code looks like this:</p>

<pre><code class="python">db = DAL('sqlite://webform.sqlite')
db.define_table('register',
    Field('first_name', requires=[IS_NOT_EMPTY(), IS_ALPHANUMERIC()]),
    Field('last_name', requires=[IS_NOT_EMPTY(), IS_ALPHANUMERIC()]),
    Field('email', unique=True, requires=[IS_NOT_EMPTY(), IS_EMAIL()]),
    Field('email_validate',requires=[IS_EMAIL(), IS_EQUAL_TO(request.vars.email)]))
db.register.email.requires=IS_NOT_IN_DB(db,'register.email')
</code></pre>

<h2><strong>Recap</strong></h2>

<p>And you&rsquo;re done. So - what all did we do?</p>

<ul>
<li><a href="http://mherman.org/blog/2012/11/27/crash-course-in-web2py-part-1/">Part 1</a>: You learned how to install web2py on your local computer and deploy a basic app on a cloud platform</li>
<li><a href="http://mherman.org/blog/2012/12/01/crash-course-in-web2py-part-2-web-forms/">Part 2</a>: You learned about Model View Control (MVC) architecture and created a skeleton web form</li>
<li><a href="http://mherman.org/blog/2012/12/06/crash-course-in-web2py-part-3-form-validation/">Part 3</a>: You added data validation to the form</li>
<li><a href="http://mherman.org/blog/2012/12/09/crash-course-in-web2py-part-4-managing-form-records/">Part 4</a>: You learned how to manage records in the database</li>
<li><a href="http://mherman.org/blog/2012/12/10/crash-course-in-web2py-part-5-modifying-the-appearance-and-deploying-the-web-form/">Part 5</a>: You learned how to modify the appearance and layout of the form</li>
</ul>


<p>Congrats!</p>

<p>What&rsquo;s next? Think about what you can do with this info.</p>

<ul>
<li>Keep practicing.</li>
<li>Build something else.</li>
<li>Make some money</li>
<li>And have fun!</li>
</ul>


<p>Thanks for reading. Cheers.</p>

<p>You can find the new code for db.py, display_your_form.html, and default.py, as well as all the files and the final packed app (.w2p) <a href="https://github.com/mjhea0/web2py/tree/master/form%20-%20part%204">here</a>.</p>
]]></content>
  </entry>
  
</feed>
