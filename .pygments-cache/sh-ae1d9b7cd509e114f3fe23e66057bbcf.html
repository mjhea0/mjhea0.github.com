<div class="highlight"><pre><span class="c">#!/usr/bin/env bash</span>

<span class="c">###################################</span>
<span class="c">### ECS Deployment Setup Script ###</span>
<span class="c">###################################</span>


<span class="c"># config</span>

<span class="nb">set</span> -e
<span class="nv">JQ</span><span class="o">=</span><span class="s2">&quot;jq --raw-output --exit-status&quot;</span>

<span class="nv">ECS_REGION</span><span class="o">=</span><span class="s2">&quot;us-east-1&quot;</span>
<span class="nv">ECS_CLUSTER</span><span class="o">=</span><span class="s2">&quot;review&quot;</span>
<span class="nv">VPC_ID</span><span class="o">=</span><span class="s2">&quot;UPDATE_ME&quot;</span>
<span class="nv">LOAD_BALANCER_ARN</span><span class="o">=</span><span class="s2">&quot;UPDATE_ME&quot;</span>
REVIEW-DEFAULT_TARGET_GROUP_ARN<span class="o">=</span><span class="s2">&quot;UPDATE_ME&quot;</span>

<span class="c"># helpers</span>

configure_aws_cli<span class="o">()</span> <span class="o">{</span>
	<span class="nb">echo</span> <span class="s2">&quot;Configuring AWS...&quot;</span>
	aws --version
	aws configure <span class="nb">set </span>default.region <span class="nv">$ECS_REGION</span>
	aws configure <span class="nb">set </span>default.output json
	<span class="nb">echo</span> <span class="s2">&quot;AWS configured!&quot;</span>
<span class="o">}</span>

get_cluster<span class="o">()</span> <span class="o">{</span>
	<span class="nb">echo</span> <span class="s2">&quot;Finding cluster...&quot;</span>
  <span class="nb">command</span> <span class="o">=</span> <span class="s2">&quot;aws ecs describe-clusters --cluster $ECS_CLUSTER&quot;</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="k">$(</span> <span class="nv">$command</span> <span class="p">|</span> <span class="nv">$JQ</span> <span class="s2">&quot;.clusters[0].status&quot;</span><span class="k">)</span> <span class="o">==</span> <span class="s1">&#39;ACTIVE&#39;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
		<span class="nb">echo</span> <span class="s2">&quot;Cluster found!&quot;</span>
	<span class="k">else</span>
		<span class="nb">echo</span> <span class="s2">&quot;Error finding cluster.&quot;</span>
		<span class="k">return</span> 1
  <span class="k">fi</span>
<span class="o">}</span>


<span class="c"># main</span>

configure_aws_cli
get_cluster
</pre></div>