<div class="highlight"><pre>get_listener_port<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;Getting listener port...&quot;</span>
  <span class="k">if</span> <span class="nv">port</span><span class="o">=</span><span class="k">$(</span>aws elbv2 describe-listeners --load-balancer-arn <span class="nv">$LOAD_BALANCER_ARN</span> <span class="p">|</span> <span class="nv">$JQ</span> <span class="s2">&quot;.Listeners | max_by(.Port) | .Port&quot;</span><span class="k">)</span><span class="p">;</span> <span class="k">then</span>
      <span class="k">if</span> <span class="o">[[</span> <span class="nv">$port</span> <span class="o">==</span> <span class="s2">&quot;80&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">port</span><span class="o">=</span>30000
      <span class="k">else</span>
        <span class="nv">port</span><span class="o">=</span><span class="k">$((</span><span class="nv">$port</span><span class="o">+</span><span class="m">1</span><span class="k">))</span>
      <span class="k">fi</span>
    <span class="nb">echo</span> <span class="s2">&quot;Listener port: $port&quot;</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Failed to get listener port.&quot;</span>
    <span class="k">return</span> 1
  <span class="k">fi</span>
<span class="o">}</span>
</pre></div>