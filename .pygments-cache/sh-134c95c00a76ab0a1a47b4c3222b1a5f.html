<div class="highlight"><pre>create_task_defs<span class="o">()</span> <span class="o">{</span>
  <span class="c"># users</span>
  <span class="nb">echo</span> <span class="s2">&quot;Creating users task definition...&quot;</span>
  <span class="nv">family</span><span class="o">=</span><span class="s2">&quot;sample-users-review-td&quot;</span>
  <span class="nv">template</span><span class="o">=</span><span class="s2">&quot;users-review_task.json&quot;</span>
  <span class="nv">task_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;ecs/tasks/$template&quot;</span><span class="k">)</span>
  <span class="nv">task_def</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$task_template&quot;</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$task_def&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Users task definition created!&quot;</span>
  register_definition
  create_target_group <span class="s2">&quot;users&quot;</span> <span class="s2">&quot;3000&quot;</span> <span class="s2">&quot;/users/ping&quot;</span>
  get_target_group_arn <span class="s2">&quot;users&quot;</span>
  add_rules <span class="s2">&quot;1&quot;</span> <span class="s2">&quot;/users*&quot;</span>
  <span class="nv">service_template_name</span><span class="o">=</span><span class="s2">&quot;users-review_service.json&quot;</span>
  <span class="nv">service_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;ecs/services/$service_template_name&quot;</span><span class="k">)</span>
  <span class="nv">service</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$service_template&quot;</span> <span class="nv">$ECS_CLUSTER</span> <span class="s2">&quot;$ECS_SERVICE-users&quot;</span> <span class="nv">$revision</span> <span class="nv">$target_group_arn</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$service&quot;</span>
  create_service
  <span class="c"># movies</span>
  <span class="nb">echo</span> <span class="s2">&quot;Creating movies task definition...&quot;</span>
  <span class="nv">family</span><span class="o">=</span><span class="s2">&quot;sample-movies-review-td&quot;</span>
  <span class="nv">template</span><span class="o">=</span><span class="s2">&quot;movies-review_task.json&quot;</span>
  <span class="nv">task_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;ecs/tasks/$template&quot;</span><span class="k">)</span>
  <span class="nv">task_def</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$task_template&quot;</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$task_def&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Movies task definition created!&quot;</span>
  register_definition
  create_target_group <span class="s2">&quot;movies&quot;</span> <span class="s2">&quot;3000&quot;</span> <span class="s2">&quot;/movies/ping&quot;</span>
  get_target_group_arn <span class="s2">&quot;movies&quot;</span>
  add_rules <span class="s2">&quot;2&quot;</span> <span class="s2">&quot;/movies*&quot;</span>
  <span class="nv">service_template_name</span><span class="o">=</span><span class="s2">&quot;movies-review_service.json&quot;</span>
  <span class="nv">service_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;ecs/services/$service_template_name&quot;</span><span class="k">)</span>
  <span class="nv">service</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$service_template&quot;</span> <span class="nv">$ECS_CLUSTER</span> <span class="s2">&quot;$ECS_SERVICE-movies&quot;</span> <span class="nv">$revision</span> <span class="nv">$target_group_arn</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$service&quot;</span>
  create_service
  <span class="c"># web</span>
  <span class="nb">echo</span> <span class="s2">&quot;Creating web task definition...&quot;</span>
  <span class="nv">family</span><span class="o">=</span><span class="s2">&quot;sample-web-review-td&quot;</span>
  <span class="nv">template</span><span class="o">=</span><span class="s2">&quot;web-review_task.json&quot;</span>
  <span class="nv">task_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;ecs/tasks/$template&quot;</span><span class="k">)</span>
  <span class="nv">task_def</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$task_template&quot;</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$task_def&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Web task definition created!&quot;</span>
  register_definition
  create_target_group <span class="s2">&quot;web&quot;</span> <span class="s2">&quot;9000&quot;</span> <span class="s2">&quot;/&quot;</span>
  get_target_group_arn <span class="s2">&quot;web&quot;</span>
  add_rules <span class="s2">&quot;3&quot;</span> <span class="s2">&quot;/&quot;</span>
  <span class="nv">service_template_name</span><span class="o">=</span><span class="s2">&quot;web-review_service.json&quot;</span>
  <span class="nv">service_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;ecs/services/$service_template_name&quot;</span><span class="k">)</span>
  <span class="nv">service</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$service_template&quot;</span> <span class="nv">$ECS_CLUSTER</span> <span class="s2">&quot;$ECS_SERVICE-web&quot;</span> <span class="nv">$revision</span> <span class="nv">$target_group_arn</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$service&quot;</span>
  create_service
<span class="o">}</span>
</pre></div>