<div class="highlight"><pre>deploy_users<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;Deploying users service...&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;(1) Tagging and pushing images...&quot;</span>
  <span class="k">$(</span>aws ecr get-login --region <span class="s2">&quot;${ECS_REGION}&quot;</span><span class="k">)</span>
	docker tag <span class="k">${</span><span class="nv">IMAGE_BASE</span><span class="k">}</span>_users-db-review <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/users-db-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
	docker tag <span class="k">${</span><span class="nv">IMAGE_BASE</span><span class="k">}</span>_users-service-review <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/users-service-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
	docker push <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/users-db-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
  docker push <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/users-service-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
  <span class="nb">echo</span> <span class="s2">&quot;Images tagged and pushed!&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;(2) Creating users task definition...&quot;</span>
  <span class="nv">family</span><span class="o">=</span><span class="s2">&quot;sample-users-review-td&quot;</span>
  <span class="nv">template</span><span class="o">=</span><span class="s2">&quot;users-review_task.json&quot;</span>
  <span class="nv">task_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;ecs/tasks/$template&quot;</span><span class="k">)</span>
  <span class="nv">task_def</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$task_template&quot;</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$task_def&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Users task definition created!&quot;</span>
  register_definition
<span class="o">}</span>

deploy_movies<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;Deploying movies service...&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;(1) Tagging and pushing images...&quot;</span>
  <span class="k">$(</span>aws ecr get-login --region <span class="s2">&quot;${ECS_REGION}&quot;</span><span class="k">)</span>
	docker tag <span class="k">${</span><span class="nv">IMAGE_BASE</span><span class="k">}</span>_movies-db-review <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/movies-db-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
	docker tag <span class="k">${</span><span class="nv">IMAGE_BASE</span><span class="k">}</span>_movies-service-review <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/movies-service-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
	docker tag <span class="k">${</span><span class="nv">IMAGE_BASE</span><span class="k">}</span>_swagger-review <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/swagger-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
	docker push <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/movies-db-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
	docker push <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/movies-service-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
	docker push <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/swagger-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
  <span class="nb">echo</span> <span class="s2">&quot;Images tagged and pushed!&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;(2) Creating movies task definition...&quot;</span>
  <span class="nv">family</span><span class="o">=</span><span class="s2">&quot;sample-movies-review-td&quot;</span>
  <span class="nv">template</span><span class="o">=</span><span class="s2">&quot;movies-review_task.json&quot;</span>
  <span class="nv">task_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;ecs/tasks/$template&quot;</span><span class="k">)</span>
  <span class="nv">task_def</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$task_template&quot;</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$task_def&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Movies task definition created!&quot;</span>
  register_definition
<span class="o">}</span>

deploy_web<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;Deploying web service...&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;(1) Tagging and pushing images...&quot;</span>
  <span class="k">$(</span>aws ecr get-login --region <span class="s2">&quot;${ECS_REGION}&quot;</span><span class="k">)</span>
	docker tag <span class="k">${</span><span class="nv">IMAGE_BASE</span><span class="k">}</span>_web-service-review <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/web-service-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
	docker push <span class="k">${</span><span class="nv">ECR_URI</span><span class="k">}</span>/<span class="k">${</span><span class="nv">NAMESPACE</span><span class="k">}</span>/web-service-review:<span class="k">${</span><span class="nv">TAG</span><span class="k">}</span>
  <span class="nb">echo</span> <span class="s2">&quot;Images tagged and pushed!&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;(2) Creating web task definition...&quot;</span>
  <span class="nv">family</span><span class="o">=</span><span class="s2">&quot;sample-web-review-td&quot;</span>
  <span class="nv">template</span><span class="o">=</span><span class="s2">&quot;web-review_task.json&quot;</span>
  <span class="nv">task_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;ecs/tasks/$template&quot;</span><span class="k">)</span>
  <span class="nv">task_def</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$task_template&quot;</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$task_def&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Web task definition created!&quot;</span>
  register_definition
<span class="o">}</span>
</pre></div>