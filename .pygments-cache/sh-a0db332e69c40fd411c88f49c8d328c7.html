<div class="highlight"><pre>Add the following <span class="o">[</span>environment variables<span class="o">](</span>https://circleci.com/docs/2.0/env-vars/#adding-environment-variables-in-the-app<span class="o">)</span> to Circle so that we can properly configure the AWS CLI:

1. <span class="sb">`</span>AWS_ACCOUNT_ID<span class="sb">`</span>
1. <span class="sb">`</span>AWS_ACCESS_KEY_ID<span class="sb">`</span>
1. <span class="sb">`</span>AWS_SECRET_ACCESS_KEY<span class="sb">`</span>

Commit your changes, and <span class="k">then</span> push to GitHub to trigger a new build. Make sure it passes before moving on.

!<span class="o">[</span>circle aws config<span class="o">](</span>/images/blog/on-demand-environments/circle-aws-config.png<span class="o">)</span>

<span class="c">## Amazon ECS Setup</span>

Moving right along, <span class="nb">let</span><span class="err">&#39;</span>s <span class="nb">set </span>up <span class="o">[</span>Amazon EC2 Container Registry<span class="o">](</span>https://aws.amazon.com/ecr/<span class="o">)</span> <span class="o">(</span>ECR<span class="o">)</span>, an image registry tied to ECS...

<span class="c">### Image Registry</span>

Steps:

1. Add images to ECR
1. Update Circle config to tag and push images on successful build

<span class="c">#### Add images to ECR</span>

Within the <span class="o">[</span>ECS Dashboard<span class="o">](</span>https://console.aws.amazon.com/ecs<span class="o">)</span>, click <span class="s2">&quot;Repositories&quot;</span> on the navigation pane, and <span class="k">then</span> click the <span class="s2">&quot;Create repository&quot;</span> button. Add the following repositories:

1. <span class="sb">`</span>sample/users-db-review<span class="sb">`</span>
1. <span class="sb">`</span>sample/movies-db-review<span class="sb">`</span>
1. <span class="sb">`</span>sample/users-service-review<span class="sb">`</span>
1. <span class="sb">`</span>sample/movies-service-review<span class="sb">`</span>
1. <span class="sb">`</span>sample/web-service-review<span class="sb">`</span>
1. <span class="sb">`</span>sample/swagger-review<span class="sb">`</span>

!<span class="o">[</span>aws ecr repos<span class="o">](</span>/images/blog/on-demand-environments/aws-ecr-repos.png<span class="o">)</span>

<span class="c">#### Tag and push images to ECR</span>

Next, add the following <span class="k">function</span> to *deploy.sh*:
</pre></div>