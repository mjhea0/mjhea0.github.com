<div class="highlight"><pre>create_task_defs<span class="o">()</span> <span class="o">{</span>
  <span class="c"># users</span>
  <span class="nb">echo</span> <span class="s2">&quot;Creating users task definition...&quot;</span>
  <span class="nv">family</span><span class="o">=</span><span class="s2">&quot;sample-users-review-td&quot;</span>
  <span class="nv">template</span><span class="o">=</span><span class="s2">&quot;users-review_task.json&quot;</span>
  <span class="nv">task_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;tasks/$template&quot;</span><span class="k">)</span>
  <span class="nv">task_def</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$task_template&quot;</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$task_def&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Users task definition created!&quot;</span>
  register_definition
  <span class="c"># movies</span>
  <span class="nb">echo</span> <span class="s2">&quot;Creating movies task definition...&quot;</span>
  <span class="nv">family</span><span class="o">=</span><span class="s2">&quot;sample-movies-review-td&quot;</span>
  <span class="nv">template</span><span class="o">=</span><span class="s2">&quot;movies-review_task.json&quot;</span>
  <span class="nv">task_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;tasks/$template&quot;</span><span class="k">)</span>
  <span class="nv">task_def</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$task_template&quot;</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$task_def&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Movies task definition created!&quot;</span>
  register_definition
  <span class="c"># web</span>
  <span class="nb">echo</span> <span class="s2">&quot;Creating web task definition...&quot;</span>
  <span class="nv">family</span><span class="o">=</span><span class="s2">&quot;sample-web-review-td&quot;</span>
  <span class="nv">template</span><span class="o">=</span><span class="s2">&quot;web-review_task.json&quot;</span>
  <span class="nv">task_template</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;tasks/$template&quot;</span><span class="k">)</span>
  <span class="nv">task_def</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;$task_template&quot;</span> <span class="nv">$AWS_ACCOUNT_ID</span> <span class="nv">$ECS_REGION</span> <span class="nv">$TAG</span> <span class="nv">$ECS_REGION</span><span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;$task_def&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Web task definition created!&quot;</span>
  register_definition
<span class="o">}</span>

register_definition<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;Registering task definition...&quot;</span>
  <span class="k">if</span> <span class="nv">revision</span><span class="o">=</span><span class="k">$(</span>aws ecs register-task-definition --cli-input-json <span class="s2">&quot;$task_def&quot;</span> --family <span class="nv">$family</span> <span class="p">|</span> <span class="nv">$JQ</span> <span class="s1">&#39;.taskDefinition.taskDefinitionArn&#39;</span><span class="k">)</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Revision: $revision&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Task definition registered!&quot;</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Failed to register task definition&quot;</span>
    <span class="k">return</span> 1
  <span class="k">fi</span>
<span class="o">}</span>
</pre></div>