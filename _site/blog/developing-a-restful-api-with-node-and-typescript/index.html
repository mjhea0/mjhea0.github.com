<!DOCTYPE html>
<html lang="en">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Developing a RESTful API with Node and TypeScript</title>
  <meta name="description" content="This tutorial takes a test-first approach to developing a RESTful API with NodeJS, ExpressJS, and TypeScript.">
  
    
    <meta name="keywords" content="node, express, typescript, RESTful API, TypeScript, tdd, test-driven development, static types">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://mherman.org/blog/developing-a-restful-api-with-node-and-typescript/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Michael Herman" href="https://mherman.org/feed.xml">

  <link rel="icon" type="image/png" href="/favicon.png">


  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="Developing a RESTful API with Node and TypeScript">
  <meta name="twitter:description" content="This tutorial takes a test-first approach to developing a RESTful API with NodeJS, ExpressJS, and TypeScript.">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  
    
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-37074204-1', 'auto');
    ga('send', 'pageview');
  </script>


  
</head>


  <link rel="stylesheet" href="/assets/hello.css">
  <link rel="stylesheet" href="/assets/carbon.css">

  <body>

    <header class="site-header">

  <div class="color-bar">
    <div class="bar bar1"></div>
    <div class="bar bar2"></div>
    <div class="bar bar3"></div>
    <div class="bar bar4"></div>
    <div class="bar bar5"></div>
    <div class="bar bar6"></div>
  </div>

  <div class="wrapper">

    <a class="site-title" href="/">Michael Herman</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/">Blog</a>
      
        
        <a class="page-link" href="/about">About</a>
      
        
        <a class="page-link" href="/talks">Talks</a>
      
        
        <a class="page-link" href="/feed.xml">RSS</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7DT27Y&placement=mhermanorg" id="_carbonads_js"></script>
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Developing a RESTful API with Node and TypeScript</h1>
    
    <p class="post-meta">
      Last updated: <time datetime="2016-11-05T00:00:00-04:00" itemprop="datePublished">Nov 5, 2016</time>
       • 
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/node/">node</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/static-types/">static types</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/testing/">testing</a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>This tutorial details how to develop a RESTful API with <a href="https://nodejs.org/en/">NodeJS</a>, <a href="http://expressjs.com/">ExpressJS</a>, and <a href="https://www.typescriptlang.org/">TypeScript</a> using test-driven development (TDD).</p>

<div style="text-align:center;">
  <img src="/assets/img/blog/typescript-logo.png" style="max-width: 80%; border:0; box-shadow: none;" alt="typescript logo" />
</div>

<p><em>We will be using:</em></p>

<ul>
  <li>NodeJS v<a href="https://nodejs.org/docs/v7.0.0/api/all.html">7.0.0</a></li>
  <li>ExpressJS v<a href="http://expressjs.com/4x/api.html">4.14.0</a></li>
  <li>TypeScript v<a href="https://github.com/Microsoft/TypeScript/releases/tag/v2.0.6">2.0.6</a></li>
</ul>

<p>Additionally, we will use <em><a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html">tsconfig.json</a></em> to configure the project, <a href="http://gulpjs.com/">Gulp</a> to automate <a href="https://en.wikipedia.org/wiki/Source-to-source_compiler">transpilation</a>, and <a href="https://github.com/typings/typings">d.ts</a> for managing typings with <code class="highlighter-rouge">npm</code>.</p>

<p><em>Updates:</em></p>

<ul>
  <li>12/08/2017: Added Windows 10 equivalent commands</li>
  <li>11/18/2017: Updated <em>ts-node</em> to the latest version</li>
  <li>03/12/2017: Updated the <em>gulpfile.js</em> and <em>package.json</em></li>
</ul>

<h2 class="no_toc" id="contents">Contents</h2>

<ul id="markdown-toc">
  <li><a href="#contents-1" id="markdown-toc-contents-1">Contents</a></li>
  <li><a href="#project-setup" id="markdown-toc-project-setup">Project Setup</a></li>
  <li><a href="#express-config" id="markdown-toc-express-config">Express Config</a></li>
  <li><a href="#the-api" id="markdown-toc-the-api">The API</a></li>
  <li><a href="#first-endpoint" id="markdown-toc-first-endpoint">First Endpoint</a></li>
  <li><a href="#second-endpoint" id="markdown-toc-second-endpoint">Second Endpoint</a></li>
  <li><a href="#whats-next" id="markdown-toc-whats-next">What’s Next?</a></li>
  <li><a href="#windows-10" id="markdown-toc-windows-10">Windows 10</a></li>
</ul>

<h2 id="contents-1">Contents</h2>

<ol>
  <li>Project Setup</li>
  <li>Express Config</li>
  <li>The API</li>
  <li>First Endpoint</li>
  <li>Second Endpoint</li>
  <li>What’s Next?</li>
</ol>

<h2 id="project-setup">Project Setup</h2>

<p>To start, we need to set a means to transpile TypeScript into JavaScript that works well with Node. Enter the <em>tsconfig.json</em> file. This is similar to a <em>package.json</em> or <em>.babelrc</em> or really any project-level configuration file you may use. As you can probably guess, it will configure the TypeScript compiler for the project.</p>

<p>Make a new directory to hold the project, and add a <em>tsconfig.json</em> file:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mkdir typescript-node-api
<span class="nv">$ </span><span class="nb">cd </span>typescript-node-api
<span class="nv">$ </span>touch tsconfig.json
</code></pre></div></div>

<p>We’ll use a pretty basic configuration for today:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"compilerOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"es6"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"module"</span><span class="p">:</span><span class="w"> </span><span class="s2">"commonjs"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"include"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"src/**/*.ts"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"exclude"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"node_modules"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Here:</p>

<ul>
  <li>in <code class="highlighter-rouge">compilerOptions</code> we tell TypeScript that we’ll be targeting ES2015 and that we’d like a <a href="https://en.wikipedia.org/wiki/CommonJS">CommonJS</a> style module as output (the same module style that Node uses)</li>
  <li>the <code class="highlighter-rouge">include</code> section tells the compiler to look for <em>.ts</em> files in the “src” directory</li>
  <li>the <code class="highlighter-rouge">exclude</code> section tells the compiler to ignore anything in “node_modules”</li>
</ul>

<blockquote>
  <p><strong>NOTE:</strong> Review the <a href="http://www.typescriptlang.org/docs/handbook/tsconfig-json.html">TypeScript docs</a> if you want more info on all the options you can define in the <em>tsconfig.json</em> file,  They are the same options that you can pass directly to the <a href="https://www.npmjs.com/package/typescript-compiler">TypeScript compiler wrapper</a>.</p>
</blockquote>

<p>Add a “src” directory:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mkdir src
</code></pre></div></div>

<p>Before moving any further, let’s make sure this configuration works like we expect using the <a href="https://www.npmjs.com/package/typescript-compiler">TypeScript compiler wrapper</a>. Create a <em>package.json</em> and install TypeScript:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm init <span class="nt">-y</span>
<span class="nv">$ </span>npm install typescript@2.0.6 <span class="nt">--save-dev</span>
</code></pre></div></div>

<p>Create a new file called <em>test.ts</em> within the “src” directory and add the following:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Hello, TypeScript!'</span><span class="p">);</span>
</code></pre></div></div>

<p>Finally, let’s run this one-liner through the compiler. From the project root, run the <code class="highlighter-rouge">tsc</code> that we installed above in our test file with:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>node_modules/.bin/tsc
</code></pre></div></div>

<p>Given no arguments, <code class="highlighter-rouge">tsc</code> will first look at <em>tsconfig.json</em> for instruction. When it finds the config, it uses those settings to build the project. You should see a new file inside of “src” called <em>test.js</em> with the same line of code in it. Awesome!</p>

<p>Now that the compiler is installed and working, let’s change up the config to make things easier on ourselves. First, we’ll add an <code class="highlighter-rouge">outDir</code> property to the <code class="highlighter-rouge">compilerOptions</code> of <code class="highlighter-rouge">tsconfig.json</code> to tell TypeScript to place all of our transpiled JavaScript into a different directory rather than compiling the files right next to their source <em>.ts</em> files:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"compilerOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"es6"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"module"</span><span class="p">:</span><span class="w"> </span><span class="s2">"commonjs"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"outDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dist"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"include"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"src/**/*.ts"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"exclude"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"node_modules"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Remove the <em>test.js</em> file from the “src” folder. Now, run the compiler again, and you’ll see that <code class="highlighter-rouge">test.js</code> is delivered to the <code class="highlighter-rouge">dist</code> directory.</p>

<p>This is much nicer, but let’s take it one step further. Instead of returning to the terminal after each change and manually running the compiler each time let’s automate the process with Gulp:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm install gulp@3.9.1 gulp-typescript@3.1.1 <span class="nt">--save-dev</span>
</code></pre></div></div>

<blockquote>
  <p><strong>NOTE:</strong> You’ll also want to globally install <code class="highlighter-rouge">gulp</code> to trigger Gulp tasks easily from the command line: <code class="highlighter-rouge">npm install -g gulp@3.9.1</code></p>
</blockquote>

<p>Add a <em>gulpfile.js</em> to the root of the directory. This is where we’ll automate the compiling of our source files:</p>

<ol>
  <li>Pull in the <em>tsconfig.json</em> and pass it to <code class="highlighter-rouge">gulp-typescript</code> for configuration</li>
  <li>Tell <code class="highlighter-rouge">gulp-typescript</code> to transpile our project and deliver it to “dist”</li>
  <li>Tell Gulp to watch our source <em>.ts</em> files, so that our transpiled JavaScript automatically gets rebuilt upon file changes</li>
</ol>

<p>Add the code:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">ts</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp-typescript'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">JSON_FILES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'src/*.json'</span><span class="p">,</span> <span class="s1">'src/**/*.json'</span><span class="p">];</span>

<span class="c1">// pull in the project TypeScript config</span>
<span class="kd">const</span> <span class="nx">tsProject</span> <span class="o">=</span> <span class="nx">ts</span><span class="p">.</span><span class="nx">createProject</span><span class="p">(</span><span class="s1">'tsconfig.json'</span><span class="p">);</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'scripts'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">tsResult</span> <span class="o">=</span> <span class="nx">tsProject</span><span class="p">.</span><span class="nx">src</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">tsProject</span><span class="p">());</span>
  <span class="k">return</span> <span class="nx">tsResult</span><span class="p">.</span><span class="nx">js</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">'dist'</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'watch'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'scripts'</span><span class="p">],</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">'src/**/*.ts'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'scripts'</span><span class="p">]);</span>
<span class="p">});</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'assets'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">JSON_FILES</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">'dist'</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'default'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'watch'</span><span class="p">,</span> <span class="s1">'assets'</span><span class="p">]);</span>
</code></pre></div></div>

<p>To test this out, remove <em>dist/test.js</em>, and then add build script to <em>package.json</em>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="s2">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gulp scripts"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span></code></pre></div></div>

<p>Then, run <code class="highlighter-rouge">npm run build</code> from the project root. You’ll see Gulp start up and <em>test.js</em> should be compiled again and placed into “dist”. Awesome! Our project is now configured.</p>

<p>Let’s move on to working with Express…</p>

<h2 id="express-config">Express Config</h2>

<p>For our Express server, we’ll use the <a href="https://github.com/expressjs/generator">express-generator</a> as our template. We’ll start with what would be the “bin/www” file and create an HTTP server, initialize it, and then attach our Express app to it.</p>

<p>Install Express along with <a href="https://github.com/visionmedia/debug">debug</a> (to provide some nice terminal output while developing):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm install express@4.14.0 debug@2.2.0 <span class="nt">--save</span>
</code></pre></div></div>

<p>In TypeScript, when you install third-party packages, you should also pull down the package’s type definitions. This tells the compiler about the structure of the module that you’re using, giving it the information needed to properly evaluate the types of structures that you use from the module.</p>

<p>Before TypeScript 2.0, dealing with <em>.d.ts</em> (type definition) files could be a real nightmare. The language had a built in tool, <code class="highlighter-rouge">tsd</code>, but it was a bear to work with and you had to decorate your TypeScript files with triple-slash comments to pull declarations into your file. Then <a href="https://github.com/typings/typings">typings</a> came along and things were much better, but there were still some issues and now you had another separate package manager to manage in your project.</p>

<p>With TypeScript 2.0, TypeScript definitions are managed by <code class="highlighter-rouge">npm</code> and installed as <a href="https://docs.npmjs.com/misc/scope">scoped packages</a>. This means two things for you:</p>

<ol>
  <li>Dependency management is simplified</li>
  <li>To install a <a href="https://www.npmjs.com/~types">type module</a>, prefix its name with <code class="highlighter-rouge">@types/</code></li>
</ol>

<p>Install the type definitions for Node, Express, and debug:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm install @types/node@6.0.46 @types/express@4.0.33 @types/debug@0.0.29 <span class="nt">--save-dev</span>
</code></pre></div></div>

<p>With that, we’re ready to create the HTTP server. Rename <em>src/test.ts</em> to <em>src/index.ts</em>, remove the console log, and add the following:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">http</span> <span class="k">from</span> <span class="s1">'http'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">debug</span> <span class="k">from</span> <span class="s1">'debug'</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">App</span> <span class="k">from</span> <span class="s1">'./App'</span><span class="p">;</span>

<span class="nx">debug</span><span class="p">(</span><span class="s1">'ts-express:server'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">normalizePort</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
<span class="nx">App</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="s1">'port'</span><span class="p">,</span> <span class="nx">port</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">App</span><span class="p">);</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">);</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">onError</span><span class="p">);</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'listening'</span><span class="p">,</span> <span class="nx">onListening</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">normalizePort</span><span class="p">(</span><span class="nx">val</span><span class="p">:</span> <span class="nx">number</span><span class="o">|</span><span class="nx">string</span><span class="p">):</span> <span class="nx">number</span><span class="o">|</span><span class="nx">string</span><span class="o">|</span><span class="kr">boolean</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">port</span><span class="p">:</span> <span class="nx">number</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">===</span> <span class="s1">'string'</span><span class="p">)</span> <span class="p">?</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">:</span> <span class="nx">val</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">port</span><span class="p">))</span> <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">port</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">port</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">onError</span><span class="p">(</span><span class="nx">error</span><span class="p">:</span> <span class="nx">NodeJS</span><span class="p">.</span><span class="nx">ErrnoException</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">syscall</span> <span class="o">!==</span> <span class="s1">'listen'</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">bind</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">port</span> <span class="o">===</span> <span class="s1">'string'</span><span class="p">)</span> <span class="p">?</span> <span class="s1">'Pipe '</span> <span class="o">+</span> <span class="nx">port</span> <span class="p">:</span> <span class="s1">'Port '</span> <span class="o">+</span> <span class="nx">port</span><span class="p">;</span>
  <span class="k">switch</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'EACCES'</span><span class="p">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">bind</span><span class="p">}</span><span class="s2"> requires elevated privileges`</span><span class="p">);</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'EADDRINUSE'</span><span class="p">:</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">bind</span><span class="p">}</span><span class="s2"> is already in use`</span><span class="p">);</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">onListening</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">addr</span> <span class="o">=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">address</span><span class="p">();</span>
  <span class="kd">let</span> <span class="nx">bind</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">addr</span> <span class="o">===</span> <span class="s1">'string'</span><span class="p">)</span> <span class="p">?</span> <span class="s2">`pipe </span><span class="p">${</span><span class="nx">addr</span><span class="p">}</span><span class="s2">`</span> <span class="p">:</span> <span class="s2">`port </span><span class="p">${</span><span class="nx">addr</span><span class="p">.</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="nx">debug</span><span class="p">(</span><span class="s2">`Listening on </span><span class="p">${</span><span class="nx">bind</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If you’re using an editor with rich TypeScript <a href="https://atom.io/packages/atom-typescript">support</a>, it’s not going to appreciate <code class="highlighter-rouge">import App from './App';</code>, but just ignore it for now. The rest of this file is pretty straightforward:</p>

<ol>
  <li>Use <code class="highlighter-rouge">debug</code> to set up some terminal logging for the app</li>
  <li>Get a port value from the environment, or set a default port number of 3000</li>
  <li>Create the HTTP server, and pass <code class="highlighter-rouge">App</code> to it (this will be our Express app)</li>
  <li>Set up some basic error handling and a terminal log to show us when the app is ready and listening</li>
</ol>

<p>Since this file will start the app, let’s also add a <code class="highlighter-rouge">"start"</code> script to <code class="highlighter-rouge">package.json</code> for convenience:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="s2">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node dist/index.js"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gulp scripts"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span></code></pre></div></div>

<p>Before we can start the app up, let’s make the <em>App.ts</em> file that we referenced on in <em>index.ts</em>. It’s also a good time to go ahead and install the dependencies we’ll use in the Express application.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>touch src/App.ts
<span class="nv">$ </span>npm install express@4.14.0 body-parser@1.15.2 morgan@1.7.0 <span class="nt">--save</span>
<span class="nv">$ </span>npm install @types/body-parser@0.0.33 @types/morgan@1.7.32 <span class="nt">--save-dev</span>
</code></pre></div></div>

<p>Inside of <em>App.ts</em> let’s create the <code class="highlighter-rouge">App</code> class to package up and configure our Express server. An instance of <code class="highlighter-rouge">App</code> will:</p>

<ul>
  <li>Hold a reference to our instance of Express</li>
  <li>Automatically configure any middleware that we want to use</li>
  <li>Attach any routers/route handlers that we create</li>
</ul>

<p>Essentially, it’s going to bootstrap the app and deliver it to the call to <code class="highlighter-rouge">http.createServer</code> in <em>index.ts</em>.</p>

<p><em>App.ts</em>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">path</span> <span class="k">from</span> <span class="s1">'path'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">express</span> <span class="k">from</span> <span class="s1">'express'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">logger</span> <span class="k">from</span> <span class="s1">'morgan'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">bodyParser</span> <span class="k">from</span> <span class="s1">'body-parser'</span><span class="p">;</span>

<span class="c1">// Creates and configures an ExpressJS web server.</span>
<span class="kd">class</span> <span class="nx">App</span> <span class="p">{</span>

  <span class="c1">// ref to Express instance</span>
  <span class="kr">public</span> <span class="nx">express</span><span class="p">:</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Application</span><span class="p">;</span>

  <span class="c1">//Run configuration methods on the Express instance.</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">express</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">middleware</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">routes</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// Configure Express middleware.</span>
  <span class="kr">private</span> <span class="nx">middleware</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">express</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">logger</span><span class="p">(</span><span class="s1">'dev'</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">express</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">express</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="na">extended</span><span class="p">:</span> <span class="kc">false</span> <span class="p">}));</span>
  <span class="p">}</span>

  <span class="c1">// Configure API endpoints.</span>
  <span class="kr">private</span> <span class="nx">routes</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="cm">/* This is just to get up and running, and to make sure what we've got is
     * working so far. This function will change when we start to add more
     * API endpoints */</span>
    <span class="kd">let</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
    <span class="c1">// placeholder route handler</span>
    <span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">message</span><span class="p">:</span> <span class="s1">'Hello World!'</span>
      <span class="p">});</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">express</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nx">router</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="k">new</span> <span class="nx">App</span><span class="p">().</span><span class="nx">express</span><span class="p">;</span>
</code></pre></div></div>

<p>Here’s a quick rundown:</p>

<ul>
  <li>The <code class="highlighter-rouge">App.express</code> field holds a reference to Express. This makes it easier to access <code class="highlighter-rouge">App</code> methods for configuration and simplifies exporting the configured instance to <em>index.ts</em>.</li>
  <li><code class="highlighter-rouge">App.middleware</code> configures our Express middleware. Right now we’re using the <a href="https://github.com/expressjs/morgan"><code class="highlighter-rouge">morgan</code></a> logger and <a href="https://github.com/expressjs/body-parser"><code class="highlighter-rouge">body-parser</code></a>.</li>
  <li><code class="highlighter-rouge">App.routes</code> will be used to link up our API endpoints and route handlers.</li>
</ul>

<blockquote>
  <p><strong>NOTE</strong>: If you have a text editor with rich TypeScript support, the error in <em>index.ts</em> should have disappeared.</p>
</blockquote>

<p>Currently, there’s a simple placeholder handler for the base URL that should return a JSON payload with <code class="highlighter-rouge">{ "message": "Hello World!" }</code>. Before writing more code, let’s make sure that we’re starting with a working, listening, and hopefully responding server. We’re going to use <a href="https://httpie.org/">httpie</a> for this quick sanity check.</p>

<p>Compile, and then run the server:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gulp scripts
<span class="nv">$ </span>npm start
</code></pre></div></div>

<p>To test, open a new terminal window and run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>http localhost:3000
</code></pre></div></div>

<p>If everything has gone well, you should get a response similar to this:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Connection: keep-alive
Content-Length: 26
Content-Type: application/json<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
X-Powered-By: Express

<span class="o">{</span>
    <span class="s2">"message"</span>: <span class="s2">"Hello World!"</span>
<span class="o">}</span>

</code></pre></div></div>

<p>The server is listening! Now we can start building the API.</p>

<h2 id="the-api">The API</h2>

<p>Since we’re good developers (and citizens), let’s utilize TDD (test-driven development) while we build out the API. That means we want to set up a testing environment. We’ll be writing our test files in TypeScript, and using <a href="http://mochajs.org/">Mocha</a> and <a href="http://chaijs.com/">Chai</a> to create the tests. Let’s start by installing these to our <code class="highlighter-rouge">devDependencies</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm install mocha@3.1.2 chai@3.5.0 chai-http@3.0.0 <span class="nt">--save-dev</span>
<span class="nv">$ </span>npm install @types/mocha@2.2.32 @types/chai@3.4.34 @types/chai-http@0.0.29 <span class="nt">--save-dev</span>
</code></pre></div></div>

<p>If we write out tests in <em>.ts</em> files, we’ll need to make sure that Mocha can understand them. By itself, Mocha can only interpret JavaScript files, not TypeScript. There are a number of different ways to accomplish this. To keep it simple, we’ll leverage <code class="highlighter-rouge">ts-node</code>, so that we can provide TypeScript interpretation to the Mocha environment without having to transpile the tests into different files. <code class="highlighter-rouge">ts-node</code> will interpret and transpile our TypeScript in memory as the tests are run.</p>

<p>Start by installing <code class="highlighter-rouge">ts-node</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm install ts-node@3.3.0 <span class="nt">--save-dev</span>
</code></pre></div></div>

<p>Now, in <code class="highlighter-rouge">package.json</code>, add a <code class="highlighter-rouge">test</code> script to run mocha with the <code class="highlighter-rouge">ts-node</code> register:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="s2">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node dist/index.js"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mocha --reporter spec --compilers ts:ts-node/register 'test/**/*.test.ts'"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gulp scripts"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span></code></pre></div></div>

<p>With the environment all set up, let’s write our first test for the “Hello World” route we created in <em>App.ts</em>. Start by adding a “test” folder to the route, and add a file called <em>helloWorld.test.ts</em>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">mocha</span> <span class="k">from</span> <span class="s1">'mocha'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">chai</span> <span class="k">from</span> <span class="s1">'chai'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">chaiHttp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'chai-http'</span><span class="p">);</span>

<span class="k">import</span> <span class="nx">app</span> <span class="k">from</span> <span class="s1">'../src/App'</span><span class="p">;</span>

<span class="nx">chai</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">chaiHttp</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expect</span> <span class="o">=</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">expect</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">'baseRoute'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'should be json'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">type</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'application/json'</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'should have a message prop'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">message</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>

<span class="p">});</span>
</code></pre></div></div>

<p>In the terminal, run <code class="highlighter-rouge">npm test</code> you should see both test pass for the <code class="highlighter-rouge">baseRoute</code> describe block. Excellent! Now we can test our routes as we build out the API.</p>

<h2 id="first-endpoint">First Endpoint</h2>

<p>Our API will be delivering data on superheros, so we’ll need to have a datastore for the API to access. Rather than setting up a full database, for this example let’s use a JSON file as our “database”. Grab the data <a href="https://raw.githubusercontent.com/mjhea0/typescript-node-api/master/src/data.json">here</a> and save it to a new file called <em>data.json</em> in the “src” folder.</p>

<p>With this little store of data, we’ll implement a CRUD interface for the superhero resource. To start, let’s implement an endpoint that returns all of our superheros. Here’s a test for this endpoint:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">mocha</span> <span class="k">from</span> <span class="s1">'mocha'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">chai</span> <span class="k">from</span> <span class="s1">'chai'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">chaiHttp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'chai-http'</span><span class="p">);</span>

<span class="k">import</span> <span class="nx">app</span> <span class="k">from</span> <span class="s1">'../src/App'</span><span class="p">;</span>

<span class="nx">chai</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">chaiHttp</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">expect</span> <span class="o">=</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">expect</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">'GET api/v1/heroes'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'responds with JSON array'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/api/v1/heroes'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">json</span><span class="p">;</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">an</span><span class="p">(</span><span class="s1">'array'</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">length</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'should include Wolverine'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/api/v1/heroes'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">Wolverine</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">hero</span> <span class="o">=&gt;</span> <span class="nx">hero</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">'Wolverine'</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">Wolverine</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">exist</span><span class="p">;</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">Wolverine</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nx">all</span><span class="p">.</span><span class="nx">keys</span><span class="p">([</span>
          <span class="s1">'id'</span><span class="p">,</span>
          <span class="s1">'name'</span><span class="p">,</span>
          <span class="s1">'aliases'</span><span class="p">,</span>
          <span class="s1">'occupation'</span><span class="p">,</span>
          <span class="s1">'gender'</span><span class="p">,</span>
          <span class="s1">'height'</span><span class="p">,</span>
          <span class="s1">'hair'</span><span class="p">,</span>
          <span class="s1">'eyes'</span><span class="p">,</span>
          <span class="s1">'powers'</span>
        <span class="p">]);</span>
      <span class="p">});</span>
  <span class="p">});</span>

<span class="p">});</span>
</code></pre></div></div>

<p>Add this to a new file called <em>test/hero.test.ts</em>.</p>

<p>To summarize, the test asserts that:</p>

<ul>
  <li>the endpoint is at <code class="highlighter-rouge">/api/v1/heroes</code></li>
  <li>it returns a JSON array of hero objects</li>
  <li>we can find Wolverine, and his object contains all the keys that we expect</li>
</ul>

<p>When you run <code class="highlighter-rouge">npm test</code>, you should see this one fail with a <code class="highlighter-rouge">Error: Not Found</code> in the terminal. Good. This is expected since we haven’t set up the route yet.</p>

<p>It’s finally that time: Let’s implement our CRUD routes!</p>

<p>To start, create a new folder <code class="highlighter-rouge">src/routes</code> and create a new file inside the directory named <em>HeroRouter.ts</em>. Inside of here, we’ll implement each CRUD route for the superhero resource. To hold each route, we’ll have a <code class="highlighter-rouge">HeroRouter</code> class that defines the handler for each route, and an <code class="highlighter-rouge">init</code> function that attaches each handler to an endpoint with the help of an instance of <code class="highlighter-rouge">Express.Router</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Router</span><span class="p">,</span> <span class="nx">Request</span><span class="p">,</span> <span class="nx">Response</span><span class="p">,</span> <span class="nx">NextFunction</span><span class="p">}</span> <span class="k">from</span> <span class="s1">'express'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">Heroes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../data'</span><span class="p">);</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">HeroRouter</span> <span class="p">{</span>
  <span class="nl">router</span><span class="p">:</span> <span class="nx">Router</span>

  <span class="cm">/**
   * Initialize the HeroRouter
   */</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">router</span> <span class="o">=</span> <span class="nx">Router</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="cm">/**
   * GET all Heroes.
   */</span>
  <span class="kr">public</span> <span class="nx">getAll</span><span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">Request</span><span class="p">,</span> <span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">,</span> <span class="nx">next</span><span class="p">:</span> <span class="nx">NextFunction</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">Heroes</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/**
   * Take each handler, and attach to one of the Express.Router's
   * endpoints.
   */</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAll</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="c1">// Create the HeroRouter, and export its configured Express.Router</span>
<span class="kd">const</span> <span class="nx">heroRoutes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HeroRouter</span><span class="p">();</span>
<span class="nx">heroRoutes</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">heroRoutes</span><span class="p">.</span><span class="nx">router</span><span class="p">;</span>
</code></pre></div></div>

<p>We also need to modify the <code class="highlighter-rouge">routes</code> function of <code class="highlighter-rouge">App</code> to use our new <code class="highlighter-rouge">HeroRouter</code>. Add the import at the top of <em>App.ts</em>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">HeroRouter</span> <span class="k">from</span> <span class="s1">'./routes/HeroRouter'</span><span class="p">;</span>
</code></pre></div></div>

<p>Then add the API endpoint to <code class="highlighter-rouge">private routes(): void</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Configure API endpoints.</span>
<span class="kr">private</span> <span class="nx">routes</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
  <span class="cm">/* This is just to get up and running, and to make sure what we've got is
   * working so far. This function will change when we start to add more
   * API endpoints */</span>
  <span class="kd">let</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
  <span class="c1">// placeholder route handler</span>
  <span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
      <span class="na">message</span><span class="p">:</span> <span class="s1">'Hello World!'</span>
    <span class="p">});</span>
  <span class="p">});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">express</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nx">router</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">express</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/api/v1/heroes'</span><span class="p">,</span> <span class="nx">HeroRouter</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now run <code class="highlighter-rouge">npm test</code> and ensure that our tests pass:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>baseRoute
  ✓ should be json
  ✓ should have a message prop

GET api/v1/heroes
  ✓ responds with JSON array
  ✓ should include Wolverine
</code></pre></div></div>

<h2 id="second-endpoint">Second Endpoint</h2>

<p>Now we’re really rolling! Before moving on though, let’s break the process down since we’ll be repeating it to create and attach each of our route handlers:</p>

<ol>
  <li>Create a method on <code class="highlighter-rouge">HeroRouter</code> that takes the arguments of your typical Express request handler: <code class="highlighter-rouge">request</code>, <code class="highlighter-rouge">response</code>, and <code class="highlighter-rouge">next</code>.</li>
  <li>Implement the server’s response for the endpoint.</li>
  <li>Inside of <code class="highlighter-rouge">init</code>, use <code class="highlighter-rouge">HeroRouter</code>’s instance of the Express <code class="highlighter-rouge">Router</code> to attach the handler to an endpoint of the API.</li>
</ol>

<p>We’ll follow this same workflow for each endpoint, and can leave <code class="highlighter-rouge">App</code> alone. All of our <code class="highlighter-rouge">HeroRouter</code> endpoints will be appended to <code class="highlighter-rouge">/api/v1/heroes</code>. Let’s implement a <code class="highlighter-rouge">GET</code> handler that returns a single hero by the <code class="highlighter-rouge">id</code> property. We’ll test the endpoint by looking for Luke Cage, who has an <code class="highlighter-rouge">id</code> of 1.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'GET api/v1/heroes/:id'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'responds with single JSON object'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/api/v1/heroes/1'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">json</span><span class="p">;</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">an</span><span class="p">(</span><span class="s1">'object'</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">});</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'should return Luke Cage'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/api/v1/heroes/1'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">hero</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s1">'Luke Cage'</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">});</span>

<span class="p">});</span>
</code></pre></div></div>

<p>And the route handler:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * GET one hero by id
 */</span>
<span class="kr">public</span> <span class="nx">getOne</span><span class="p">(</span><span class="nx">req</span><span class="p">:</span> <span class="nx">Request</span><span class="p">,</span> <span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">,</span> <span class="nx">next</span><span class="p">:</span> <span class="nx">NextFunction</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">query</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">hero</span> <span class="o">=</span> <span class="nx">Heroes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">hero</span> <span class="o">=&gt;</span> <span class="nx">hero</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">query</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">hero</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">message</span><span class="p">:</span> <span class="s1">'Success'</span><span class="p">,</span>
        <span class="na">status</span><span class="p">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
        <span class="nx">hero</span>
      <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">message</span><span class="p">:</span> <span class="s1">'No hero found with the given id.'</span><span class="p">,</span>
        <span class="na">status</span><span class="p">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 * Take each handler, and attach to one of the Express.Router's
 * endpoints.
 */</span>
<span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAll</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/:id'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getOne</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Run the tests!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>baseRoute
  ✓ should be json
  ✓ should have a message prop

GET api/v1/heroes
  ✓ responds with JSON array
  ✓ should include Wolverine
    ✓ responds with single JSON object
    ✓ should return Luke Cage
</code></pre></div></div>

<h2 id="whats-next">What’s Next?</h2>

<p>For the hero resource, we should have endpoints for updating a hero and deleting a hero, but we’ll leave that for you to implement. The structure that we’ve set up here should guide you through creating those last endpoints.</p>

<p>Once the hero resource is implemented, we could add more resources to the API easily. To follow the same process we would:</p>

<ol>
  <li>Create a new file inside of <em>src/routes</em> to be the router for the resource.</li>
  <li>Attach the resource router to the Express app inside of the <code class="highlighter-rouge">routes</code> method of <code class="highlighter-rouge">App</code>.</li>
</ol>

<p>Now you’re up and running with Express and TypeScript 2.0. Go build something! You can grab the code from the <a href="https://github.com/mjhea0/typescript-node-api">typescript-node-api</a> repo. Cheers!</p>

<h2 id="windows-10">Windows 10</h2>

<p>On Windows 10? Here are some edits and command line equivalents:</p>

<table>
  <thead>
    <tr>
      <th>Unix</th>
      <th>Windows</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">touch tsconfig.json</code></td>
      <td><code class="highlighter-rouge">copy /b tsconfig.json +,,</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">node_modules/.bin/tsc</code></td>
      <td><code class="highlighter-rouge">.\node_modules\\.bin\\tsc</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">mocha --reporter spec --compilers ts:ts-node/register 'test/**/*.test.ts'</code></td>
      <td><code class="highlighter-rouge">mocha --reporter spec --compilers ts:ts-node/register \"test/**/*.test.ts*\""</code></td>
    </tr>
  </tbody>
</table>

<p>You also may need to install:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm install @types/express-serve-static-core@4.0.49
</code></pre></div></div>

<p>And:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm install <span class="nt">-g</span> chai@3.0.0 <span class="se">\</span>
              chai-webdriver@1.2.0 <span class="se">\</span>
              webdriver-sizzle@0.2.2 <span class="se">\</span>
              selenium-webdriver@3.6.0
</code></pre></div></div>

  </div>

  <!-- addthis -->
  
    <div class="sharing">
  <br>
  <!-- AddThis Button BEGIN -->
  <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
    <a class="addthis_button_preferred_1"></a>
    <a class="addthis_button_preferred_2"></a>
    <a class="addthis_button_preferred_3"></a>
    <a class="addthis_button_preferred_4"></a>
    <a class="addthis_button_compact"></a>
    <a class="addthis_counter addthis_bubble_style"></a>
  </div>
  <script type="text/javascript">var addthis_config = {"data_track_addressbar":false};</script>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-50e5f1cc35ad077d"></script>
  <!-- AddThis Button END -->
  <br>
</div>

  

  <!-- disqus -->
  
    <div id="disqus_thread"></div>

<script>
  var disqus_config = function () {
    this.page.url = 'https://mherman.org/blog/developing-a-restful-api-with-node-and-typescript/';
    this.page.identifier = 'https://mherman.org/blog/developing-a-restful-api-with-node-and-typescript/';
  };

  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//' + 'michaelherman' + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  


</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      




<div>
  <hr>
  <p>
    <span>Copyright &copy; 2020 - Michael Herman</span>
    <br>
    <small>Questions? michael at mherman dot org</small><br>
    <small><a href="#">Back to top</a></small>
    <br>
    <span>
      <a href="https://github.com/mjhea0"><i class="fa fa-github-square" style="font-size:2em" aria-hidden="true"></i></a>
      <a href="https://twitter.com/mikeherman"><i class="fa fa-twitter-square" style="font-size:2em" aria-hidden="true"></i></a>
      <a href="https://www.linkedin.com/in/mjhea0/"><i class="fa fa-linkedin-square" style="font-size:2em" aria-hidden="true"></i></a>
      <a href="https://www.youtube.com/hermanmu"><i class="fa fa-youtube-square" style="font-size:2em" aria-hidden="true"></i></a>
    </span>
  </p>
</div>

    </p>

  </div>

</footer>


  </body>

  <script type="text/javascript" src="/assets/hello.js"></script>
</html>
