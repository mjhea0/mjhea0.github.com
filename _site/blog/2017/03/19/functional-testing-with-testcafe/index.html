<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Functional Testing with TestCafe</title>
  <meta name="description" content="Let&#39;s look at how to write end-to-end tests with TestCafe.">
  
    
    <meta name="keywords" content="node, node.js, testing, TestCafe, javascript, automated tests, functional testing, end-to-end testing, e2e, e2e tests">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://mherman.org/blog/2017/03/19/functional-testing-with-testcafe/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Michael Herman" href="http://mherman.org/feed.xml">

  <link rel="icon" type="image/x-icon" href="/favicon.ico">


  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="Functional Testing with TestCafe">
  <meta name="twitter:description" content="Let&#39;s look at how to write end-to-end tests with TestCafe.">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37074204-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>


  <body>

    <header class="site-header">

  <div class="color-bar">
    <div class="bar bar1"></div>
    <div class="bar bar2"></div>
    <div class="bar bar3"></div>
    <div class="bar bar4"></div>
    <div class="bar bar5"></div>
    <div class="bar bar6"></div>
  </div>

  <div class="wrapper">

    <a class="site-title" href="/">Michael Herman</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/">Blog</a>
      
        
        <a class="page-link" href="/about">About</a>
      
        
        <a class="page-link" href="/talks">Talks</a>
      
        
        <a class="page-link" href="/feed.xml">RSS</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Functional Testing with TestCafe</h1>
    
    <p class="post-meta"><time datetime="2017-03-19T10:37:53-06:00" itemprop="datePublished">Mar 19, 2017</time> • 
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/node/">node</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/testing/">testing</a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Today we are going to dive into the world of functional web testing with <a href="https://devexpress.github.io/testcafe/">TestCafe</a>.</p>

<p>Unlike the majority of other end-to-end (e2e) testing tools, TestCafe is not dependent on Selenium or WebDriver. Instead, it injects scripts into the browser to communicate directly with the DOM and handle events. It works on any modern browser that supports HTML5 without any plugins. Further, it supports all major operating systems and can run simultaneously on multiple browsers and machines.</p>

<div style="text-align:center;">
  <img src="/assets/img/blog/testcafe.png" style="max-width: 500px; border:0; box-shadow: none;" alt="testcafe logo" />
</div>

<p><br /></p>

<p>We will be using:</p>

<ul>
  <li>TestCafe v<a href="https://github.com/DevExpress/testcafe/releases/tag/v0.13.0">0.13.0</a></li>
  <li>Chrome v<a href="https://chromereleases.googleblog.com/2017/03/stable-channel-update-for-desktop.html">57</a></li>
  <li>NodeJS v<a href="https://nodejs.org/docs/v7.6.0/api/all.html">7.6.0</a></li>
</ul>

<p>Please review the <a href="http://devexpress.github.io/testcafe/documentation/getting-started/">Getting Started</a> guide before beginning.</p>

<h2 class="no_toc" id="contents">Contents</h2>

<ul id="markdown-toc">
  <li><a href="#contents-1" id="markdown-toc-contents-1">Contents</a></li>
  <li><a href="#objectives" id="markdown-toc-objectives">Objectives</a></li>
  <li><a href="#project-setup" id="markdown-toc-project-setup">Project Setup</a></li>
  <li><a href="#writing-tests" id="markdown-toc-writing-tests">Writing Tests</a></li>
  <li><a href="#browser-support" id="markdown-toc-browser-support">Browser Support</a></li>
  <li><a href="#continuous-integration" id="markdown-toc-continuous-integration">Continuous Integration</a></li>
</ul>

<h2 id="contents-1">Contents</h2>

<ol>
  <li>Objectives</li>
  <li>Project Setup</li>
  <li>Writing Tests</li>
  <li>Browser Support</li>
  <li>Continuous Integration</li>
  <li>Next Steps</li>
</ol>

<h2 id="objectives">Objectives</h2>

<p>By the end of this tutorial, you should be able to…</p>

<ol>
  <li>Set up TestCafe with an existing Node app</li>
  <li>Write TestCafe tests using the <a href="https://martinfowler.com/bliki/PageObject.html">PageObject</a> pattern</li>
  <li>Test a Node application with functional tests</li>
  <li>Integrate TestCafe into a continuous integration process</li>
  <li>Configure TestCafe to work with a headless browser</li>
</ol>

<h2 id="project-setup">Project Setup</h2>

<p>Start by cloning the base project structure:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/mjhea0/testcafe-example <span class="nt">--branch</span> v1 <span class="nt">--single-branch</span> <span class="nt">-b</span> master
</code></pre></div></div>

<p>Install the dependencies, and then fire up the app by running <code class="highlighter-rouge">npm start</code> to make sure all is well. Navigate to <a href="http://localhost:3000/">http://localhost:3000/</a> in your browser and you should see a list of jobs in HTML. Experiment with the app. Add a job. Update a job. Delete a job. This is what we will be testing. Kill the server when done.</p>

<div style="text-align:center;">
  <img src="/assets/img/blog/node-jobs.png" style="max-width: 100%; border:0; box-shadow: none;" alt="node jobs" />
</div>

<p>Install TestCafe:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm install testcafe@0.13.0 <span class="nt">--save-dev</span>
</code></pre></div></div>

<p>With that, you can start running tests.</p>

<blockquote>
  <p><strong>NOTE:</strong> If you were using a Selenium-based testing tool you would need to install both Selenium and Web Driver, which can be difficult depending on your system setup.</p>
</blockquote>

<p>Add a <code class="highlighter-rouge">test</code> command to the <code class="highlighter-rouge">scripts</code> in <em>package.json</em>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="s2">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node ./bin/www"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node_modules/testcafe/bin/testcafe.js chrome tests/"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span></code></pre></div></div>

<p>Here, we specified the path to TestCafe in our “node_modules” folder along with a <a href="http://devexpress.github.io/testcafe/documentation/using-testcafe/command-line-interface.html#browser-list">target browser</a>, <code class="highlighter-rouge">chrome</code>, and a  <a href="http://devexpress.github.io/testcafe/documentation/using-testcafe/command-line-interface.html#file-pathglob-pattern">path</a> to where all tests will be located, <code class="highlighter-rouge">tests/</code>.</p>

<p>Now, you can use <code class="highlighter-rouge">npm test</code> to run TestCafe.</p>

<p>Let’s get a test set up. Add a “tests” folder to the project root, and add an <em>index.js</em> file to it:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Selector</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'testcafe'</span><span class="p">;</span>

<span class="nx">fixture</span><span class="p">(</span><span class="s1">'Getting Started'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">page</span><span class="p">(</span><span class="s1">'https://github.com'</span><span class="p">);</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">'Find "testcafe-example" repo on GitHub'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">repo</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">'.repo-list &gt; li &gt; div'</span><span class="p">);</span>
  <span class="c1">// search github</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">'form[action="/search"]'</span><span class="p">,</span> <span class="s1">'testcafe-example user:mjhea0'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">pressKey</span><span class="p">(</span><span class="s1">'enter'</span><span class="p">);</span>
  <span class="c1">// check li for results</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">repo</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'mjhea0/testcafe-example'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>What’s happening?</p>

<ol>
  <li>Since <em>all</em> tests are organized into <a href="http://devexpress.github.io/testcafe/documentation/test-api/test-code-structure.html#fixtures">fixtures</a>, we started with a <code class="highlighter-rouge">fixture()</code> function.</li>
  <li>Next, we specified a start URL - <code class="highlighter-rouge">http://devexpress.github.io/testcafe/example</code> - via the <code class="highlighter-rouge">page()</code> <a href="http://devexpress.github.io/testcafe/documentation/test-api/test-code-structure.html#specifying-the-start-webpage">method</a>.</li>
  <li>From there, we added the test code into a <code class="highlighter-rouge">test()</code> <a href="http://devexpress.github.io/testcafe/documentation/test-api/test-code-structure.html#tests">function</a>, which takes an async function along with the <a href="http://devexpress.github.io/testcafe/documentation/test-api/test-code-structure.html#test-controller">test controller</a> object.</li>
  <li><code class="highlighter-rouge">await</code> is then used to wait for certain <a href="http://devexpress.github.io/testcafe/documentation/test-api/actions/">actions</a> to complete. In this case, we used <code class="highlighter-rouge">typeText()</code> and <code class="highlighter-rouge">pressKey()</code> to search GitHub.</li>
  <li>On the GitHub search results page, we used a <code class="highlighter-rouge">Selector()</code> <a href="http://devexpress.github.io/testcafe/documentation/test-api/selecting-page-elements/selectors.html">function</a> to parse the DOM.</li>
  <li>Finally, we asserted that the actual results contain the expected results.</li>
</ol>

<blockquote>
  <p><strong>NOTE:</strong> If you’re new to <a href="https://github.com/tc39/ecmascript-asyncawait">async/await</a>, check out <a href="https://ponyfoo.com/articles/understanding-javascript-async-await">Understanding JavaScript’s async await</a>.</p>
</blockquote>

<p>Try this out! Run <code class="highlighter-rouge">npm test</code>. If all goes well Chrome should fire up and execute the test. Once done, you should see something like this in your terminal:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running tests <span class="k">in</span>:
- Chrome 57.0.2987 / Mac OS X 10.11.6

Getting Started
✓ Find <span class="s2">"testcafe-example"</span> repo on GitHub
</code></pre></div></div>

<p>Make sense? No? Continue to run the test and review the above steps until it does. Make sure you understand what’s happening before moving on.</p>

<h2 id="writing-tests">Writing Tests</h2>

<p>Add a new file called <em>jobs.js</em> to the “tests” folder:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Selector</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'testcafe'</span><span class="p">;</span>

<span class="nx">fixture</span><span class="p">(</span><span class="s1">'Node Jobs'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">page</span><span class="p">(</span><span class="s1">'http://localhost:3000'</span><span class="p">);</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">'All Jobs'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

<span class="p">});</span>
</code></pre></div></div>

<p>Then update the <code class="highlighter-rouge">test</code> command in <em>package.json</em>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node_modules/testcafe/bin/testcafe.js chrome tests/jobs.js --app 'npm start'"</span><span class="w">
</span></code></pre></div></div>

<p><code class="highlighter-rouge">tests/jobs.js</code> ignores the example GitHub test found in <em>index.js</em> so that we can focus just on the tests added to <em>jobs.js</em>. The <code class="highlighter-rouge">--app</code> <a href="https://devexpress.github.io/testcafe/documentation/using-testcafe/command-line-interface.html#-a-command---app-command">option</a> is used to launch the Node app so that TestCafe can interact with it.</p>

<p>Try it. You should see the page load in Chrome. With that, let’s test each of our app’s CRUD functions.</p>

<h3 id="get-all-jobs">GET ALL Jobs</h3>

<p>Update <em>jobs.js</em>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Selector</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'testcafe'</span><span class="p">;</span>

<span class="nx">fixture</span><span class="p">(</span><span class="s1">'Node Jobs'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">page</span><span class="p">(</span><span class="s1">'http://localhost:3000'</span><span class="p">);</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">'All Jobs'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">tableRows</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">'tbody &gt; tr'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">addJobButton</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">'a.btn.btn-primary'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">firstJob</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">'tbody &gt; tr'</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">'Horse Whisperer'</span><span class="p">);</span>
  <span class="c1">// check title, add job button, table rows, and job exists</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'All Jobs'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">addJobButton</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'Add New Job'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRows</span><span class="p">.</span><span class="nx">count</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">firstJob</span><span class="p">.</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>What’s happening? Review the code above, line by line. It should be fairly straightforward.  Turn to the <a href="https://devexpress.github.io/testcafe/documentation/test-api/selecting-page-elements/">docs</a> for help, adding comments as necessary.</p>

<p>Run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Node Jobs
✓ All Jobs


1 passed <span class="o">(</span>0s<span class="o">)</span>
</code></pre></div></div>

<p>Before moving on, refactor out the selectors so that they can be re-used by other test cases:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Selector</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'testcafe'</span><span class="p">;</span>

<span class="c1">// selectors</span>
<span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">tableRows</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">'tbody &gt; tr'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">addJobButton</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">'a.btn.btn-primary'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">firstJob</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">'tbody &gt; tr'</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">'Horse Whisperer'</span><span class="p">);</span>

<span class="nx">fixture</span><span class="p">(</span><span class="s1">'Node Jobs'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">page</span><span class="p">(</span><span class="s1">'http://localhost:3000'</span><span class="p">);</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">'All Jobs'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// check title, add job button, table rows, and job exists</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'All Jobs'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">addJobButton</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'Add New Job'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRows</span><span class="p">.</span><span class="nx">count</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">firstJob</span><span class="p">.</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="add-job">Add Job</h3>

<p>Start by adding a new <code class="highlighter-rouge">test()</code> function to <em>jobs.js</em>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">test</span><span class="p">.</span><span class="nx">only</span><span class="p">(</span><span class="s1">'New Job'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

<span class="p">});</span>
</code></pre></div></div>

<blockquote>
  <p><strong>NOTE:</strong> Can you guess what <code class="highlighter-rouge">only()</code> does? Try running the tests to see. Please review the <a href="https://devexpress.github.io/testcafe/documentation/test-api/test-code-structure.html#skipping-tests">docs</a> for more info.</p>
</blockquote>

<p>Think about the steps an end user has to go through to add a job:</p>

<ol>
  <li>Click the add job button</li>
  <li>Fill out the form</li>
  <li>Submit the form</li>
</ol>

<p>Now, try this on your own, step by step, before looking at the solution…</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">test</span><span class="p">.</span><span class="nx">only</span><span class="p">(</span><span class="s1">'New Job'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// click add job button</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">addJobButton</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'Add Job'</span><span class="p">);</span>
  <span class="c1">// fill out form</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">'input[name="title"]'</span><span class="p">,</span> <span class="s1">'Python Developer'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">'textarea[name="description"]'</span><span class="p">,</span> <span class="s1">'Write some Python'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">'input[name="company"]'</span><span class="p">,</span> <span class="s1">'Real Python'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">'input[name="email"]'</span><span class="p">,</span> <span class="s1">'michael@realpython.com'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">submitButton</span><span class="p">)</span>
  <span class="c1">// check title, table rows, and new job exists</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'All Jobs'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRows</span><span class="p">.</span><span class="nx">count</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">'tbody &gt; tr'</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">'Python Developer'</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Make sure to add the selector to the top:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">submitButton</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">'button[type="submit"]'</span><span class="p">);</span>
</code></pre></div></div>

<p>Test it out. Then remove the <code class="highlighter-rouge">only()</code> and test again:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Node Jobs
✓ All Jobs
✓ New Job


2 passed <span class="o">(</span>4s<span class="o">)</span>
</code></pre></div></div>

<p>What are we missing in this test?</p>

<ol>
  <li>What happens if the cancel button is pressed?</li>
  <li>What if the end user does not enter data for all the fields?</li>
  <li>What if text is entered in the email field but it is not a valid email?</li>
</ol>

<p>Try testing for these on your own.</p>

<h3 id="update-job">Update Job</h3>

<p>Again, start by adding the boilerplate:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">test</span><span class="p">(</span><span class="s1">'Update Job'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

<span class="p">});</span>
</code></pre></div></div>

<p>Then write out the steps the end user has to take before writing any code:</p>

<ol>
  <li>Click the update button</li>
  <li>Fill out the form</li>
  <li>Submit the form</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">test</span><span class="p">(</span><span class="s1">'Update Job'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// click update button</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">firstJob</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'a.btn.btn-warning'</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'Update Job'</span><span class="p">);</span>
  <span class="c1">// fill out form</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">'input[name="title"]'</span><span class="p">,</span> <span class="s1">'testing an update'</span><span class="p">,</span> <span class="p">{</span><span class="na">replace</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">'textarea[name="description"]'</span><span class="p">,</span> <span class="s1">'test'</span><span class="p">,</span> <span class="p">{</span><span class="na">replace</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">'input[name="company"]'</span><span class="p">,</span> <span class="s1">'test'</span><span class="p">,</span> <span class="p">{</span><span class="na">replace</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">'input[name="email"]'</span><span class="p">,</span> <span class="s1">'t@t.com'</span><span class="p">,</span> <span class="p">{</span><span class="na">replace</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">submitButton</span><span class="p">)</span>
  <span class="c1">// check title, table rows, and updated job exists</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'All Jobs'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRows</span><span class="p">.</span><span class="nx">count</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="c1">// why 4?</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">firstJob</span><span class="p">.</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">'tbody &gt; tr'</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">'testing an update'</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Test:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Node Jobs
✓ All Jobs
✓ New Job
✓ Update Job


3 passed <span class="o">(</span>8s<span class="o">)</span>
</code></pre></div></div>

<p>What else should you test for? Write the test cases on your own.</p>

<p>Also, did you notice the code smell? There’s a lot of code duplication happening between those last two test cases. How could this be better handled?</p>

<p>Finally, did you notice that there are still four jobs in the table? Why? Could there be issues with testing the previous two tests together rather than in isolation? Probably not in this case, but if there are, you could always wrap the update in a new <code class="highlighter-rouge">fixture()</code>, since this restores the page to its initial state.</p>

<h3 id="delete-job">Delete Job</h3>

<p>Run the app again with <code class="highlighter-rouge">npm start</code> to review, from the end user’s perspective, what happens when you try to delete a job.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">test</span><span class="p">(</span><span class="s1">'Delete Job'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// click delete button</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">setNativeDialogHandler</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">clayDryerJob</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'a.btn.btn-danger'</span><span class="p">))</span>
  <span class="c1">// check title, table rows, and updated job exists</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'All Jobs'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRows</span><span class="p">.</span><span class="nx">count</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// why 3?</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">clayDryerJob</span><span class="p">.</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Did you notice the <code class="highlighter-rouge">setNativeDialogHandler()</code> function? <a href="https://devexpress.github.io/testcafe/documentation/test-api/handling-native-dialogs.html#dialog-handler">This</a> tells TestCafe how to handle the alert.</p>

<p>What if we click “cancel” instead of “ok”?</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">test</span><span class="p">(</span><span class="s1">'Delete Job'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// click delete button</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">setNativeDialogHandler</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">// =&gt; press ok</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">clayDryerJob</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'a.btn.btn-danger'</span><span class="p">))</span>
  <span class="c1">// check title, table rows, and updated job exists</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'All Jobs'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRows</span><span class="p">.</span><span class="nx">count</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// why 3?</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">clayDryerJob</span><span class="p">.</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">();</span>
    <span class="c1">// click delete button</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">setNativeDialogHandler</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">)</span> <span class="c1">// =&gt; press cancel</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">tableRows</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'a.btn.btn-danger'</span><span class="p">))</span>
  <span class="c1">// check title, table rows, and updated job exists</span>
  <span class="kr">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">innerText</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="s1">'All Jobs'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRows</span><span class="p">.</span><span class="nx">count</span><span class="p">).</span><span class="nx">eql</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// why 3?</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Run the tests:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Node Jobs
✓ All Jobs
✓ New Job
✓ Update Job
✓ Delete Job


4 passed <span class="o">(</span>9s<span class="o">)</span>
</code></pre></div></div>

<p>Again, handle any edge cases on you own and clean up the code smell.</p>

<h2 id="browser-support">Browser Support</h2>

<p>Aside for Chrome, TestCafe <a href="https://devexpress.github.io/testcafe/documentation/using-testcafe/common-concepts/browser-support.html#officially-supported-browsers">supports</a> a number of browsers out-of-the-box. Further, if you don’t need to test browser-dependent functionality, then you can use a headless browser.</p>

<p>Start by installing the <a href="https://github.com/ryx/testcafe-browser-provider-nightmare">plugin</a>, which is powered by <a href="https://github.com/segmentio/nightmare">Nightmare</a>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm install testcafe-browser-provider-nightmare@0.0.4 <span class="nt">--save-dev</span>
</code></pre></div></div>

<p>Update the <code class="highlighter-rouge">test</code> command in <em>package.json</em>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node_modules/testcafe/bin/testcafe.js nightmare tests/jobs.js --app 'npm start'"</span><span class="w">
</span></code></pre></div></div>

<p>Run the tests, and you should see:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running tests <span class="k">in</span>:
- Electron 1.6.2 / Mac OS X 10.11.6

Node Jobs
✓ All Jobs
✓ New Job
✓ Update Job
✓ Delete Job


4 passed <span class="o">(</span>9s<span class="o">)</span>
</code></pre></div></div>

<p>There’s also a <a href="https://github.com/DevExpress/testcafe-browser-provider-saucelabs">plugin</a> for cross browser support powered by <a href="https://saucelabs.com/">SauceLabs</a>.</p>

<h2 id="continuous-integration">Continuous Integration</h2>

<p>Finally, let’s incorporate TestCafe into our Continuous Integration (CI) process with <a href="https://travis-ci.org/">Travis CI</a>.</p>

<blockquote>
  <p><strong>NOTE:</strong> New to Travis? Review the <a href="https://docs.travis-ci.com/user/for-beginners">Travis CI for Complete Beginners</a> guide along with <a href="http://devexpress.github.io/testcafe/documentation/recipes/running-tests-in-firefox-and-chrome-using-travis-ci.html">Running Tests in Firefox and Chrome Using Travis CI</a>.</p>
</blockquote>

<p>After you enable Travis CI for the repository you are working with, add a <em>.travis.yml</em> file to the project root:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>language: node_js
node_js: "7"

dist: trusty
sudo: required

addons:
  apt:
    sources:
     - google-chrome
    packages:
     - google-chrome-stable

before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3
</code></pre></div></div>

<p>Here, we added the Node version along with some basic Chrome settings. Also, we have to use <a href="https://docs.travis-ci.com/user/gui-and-headless-browsers/#Using-xvfb-to-Run-Tests-That-Require-a-GUI">xvfb</a> to fake a GUI so that Chrome thinks it’s running in a graphical environment.</p>

<hr />
<p><br /></p>

<p>That’s it. Grab the final code from the <a href="https://github.com/mjhea0/testcafe-example">testcafe-example</a> repo. Comment below if you have questions.</p>

  </div>

  <!-- addthis -->
  
    <div class="sharing">
  <br>
  <!-- AddThis Button BEGIN -->
  <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
    <a class="addthis_button_preferred_1"></a>
    <a class="addthis_button_preferred_2"></a>
    <a class="addthis_button_preferred_3"></a>
    <a class="addthis_button_preferred_4"></a>
    <a class="addthis_button_compact"></a>
    <a class="addthis_counter addthis_bubble_style"></a>
  </div>
  <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-50e5f1cc35ad077d"></script>
  <!-- AddThis Button END -->
  <br>
</div>

  

  <!-- disqus -->
  
    <div id="disqus_thread"></div>

<script>
  var disqus_config = function () {
    this.page.url = 'http://mherman.org/blog/2017/03/19/functional-testing-with-testcafe/';
    this.page.identifier = 'http://mherman.org/blog/2017/03/19/functional-testing-with-testcafe/';
  };

  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//' + 'michaelherman' + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  


</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      




<div>
  <hr>
  <p>
    <span>Copyright &copy; 2017 - Michael Herman</span>
    <br>
    <small>Questions? michael at mherman dot org</small><br>
    <small><a href="#">Back to top</a></small>
    <br>
    <span>
      <a href="https://github.com/mjhea0"><i class="fa fa-github-square" style="font-size:2em" aria-hidden="true"></i></a>
      <a href="https://twitter.com/mikeherman"><i class="fa fa-twitter-square" style="font-size:2em" aria-hidden="true"></i></a>
      <a href="http://www.linkedin.com/pub/michael-herman/3b/a94/4"><i class="fa fa-linkedin-square" style="font-size:2em" aria-hidden="true"></i></a>
      <a href="http://www.youtube.com/hermanmu"><i class="fa fa-youtube-square" style="font-size:2em" aria-hidden="true"></i></a>
    </span>
  </p>
</div>

    </p>

  </div>

</footer>


    
      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-37074204-1', 'auto');
  ga('send', 'pageview');
</script>

    

  </body>

</html>
