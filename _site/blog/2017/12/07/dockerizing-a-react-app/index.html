<hr />
<p>layout: post
title: “Dockerizing a React App”
date: 2017-12-07 08:23:24
comments: true
toc: true
categories: [docker, react]
keywords: “docker, react,</p>

<p><a href="https://www.docker.com/">Docker</a> is a technology that helps to speed up the development and deployment processes. If you’re working with microservices, Docker makes it much easier to link together small, independent services. It also helps to eliminate environment-specific bugs since you can replicate your production environment locally.</p>

<p>This tutorial demonstrates how to Dockerize a React app using the <a href="https://github.com/facebookincubator/create-react-app">Create React App</a> generator. We’ll specifically focus on setting up a development environment with code hot-reloading.</p>

<div style="text-align:center;">
  <img src="/assets/img/blog/docker-logo.png" style="max-width: 100%; border:0; box-shadow: none;" alt="docker" />
</div>

<p><br /></p>

<p><em>We will be using:</em></p>

<ul>
  <li>Docker v17.09.0-ce</li>
  <li>Create React App v1.4.3</li>
  <li>Node v9.2</li>
</ul>

<h2 id="project-setup">Project Setup</h2>

<p>Install <a href="https://github.com/facebookincubator/create-react-app">Create React App</a>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm install <span class="nt">-g</span> create-react-app@1.4.3
</code></pre></div></div>

<p>Generate a new app:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>create-react-app sample-app
<span class="nv">$ </span><span class="nb">cd </span>sample-app
</code></pre></div></div>

<h2 id="docker">Docker</h2>

<p>Add a Dockerfile to the project root:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># base image
FROM node:9.2

# set working directory
RUN mkdir /usr/src/app
WORKDIR /usr/src/app

# add `/usr/src/app/node_modules/.bin` to $PATH
ENV PATH /usr/src/app/node_modules/.bin:$PATH

# install and cache app dependencies
ADD package.json /usr/src/app/package.json
RUN npm install --silent
RUN npm install react-scripts@1.0.17 -g --silent

# start app
CMD ["npm", "start"]
</code></pre></div></div>

<blockquote>
  <p>Silencing the NPM output via <code class="highlighter-rouge">--silent</code> is a personal choice. It’s often frowned upon, though, since it can swallow errors. Keep this in mind so you don’t waste time debugging.</p>
</blockquote>

<p>Add a <em>.dockerignore</em>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node_modules
</code></pre></div></div>

<p>So, this will greatly speed up the Docker build process as our local dependencies will not be sent to the Docker daemon.</p>

<p>Build and tag the Docker image:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker build <span class="nt">-t</span> sample-app <span class="nb">.</span>
</code></pre></div></div>

<p>Then, spin up the container once the build is done:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">-v</span> <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>:/usr/src/app <span class="nt">-p</span> 3000:3000 <span class="nt">--rm</span> sample-app
</code></pre></div></div>

<p>Open your browser to <a href="http://localhost:3000/">http://localhost:3000/</a> and you should see the app. Try making a change to the <code class="highlighter-rouge">App</code> component within your code editor. You should see the app hot-reload.</p>

<p>Want to use <a href="https://docs.docker.com/compose/">Docker Compose</a>? Add a <em>docker-compose.yml</em> file to the project root:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.3'</span>

<span class="na">services</span><span class="pi">:</span>

  <span class="na">sample-app</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">sample-app</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.:/usr/src/app'</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">3000:3000'</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=development</span>
</code></pre></div></div>

<p>Build the image and fire up the container:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose up <span class="nt">-d</span> <span class="nt">--build</span>
</code></pre></div></div>

<p>Ensure the app is running in the browser and test hot-reloading again. Bring down the containers before moving on:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose stop
</code></pre></div></div>

<h2 id="docker-machine">Docker Machine</h2>

<p>To get hot-reloading to work with <a href="https://docs.docker.com/machine/">Docker Machine</a> and <a href="https://docs.docker.com/machine/get-started/">VirtualBox</a> you’ll need to <a href="https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md#troubleshooting">enable</a> a polling mechanism via <a href="https://github.com/paulmillr/chokidar">chokidar</a>.</p>

<p>Create a new Machine:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine create <span class="nt">-d</span> virtualbox sample
<span class="nv">$ </span>docker-machine env sample
<span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env sample<span class="k">)</span>
</code></pre></div></div>

<p>Grab the IP address:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-machine ip sample
</code></pre></div></div>

<p>Then, build the images and run the containers:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker build <span class="nt">-t</span> sample-app <span class="nb">.</span>
<span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">-v</span> <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>:/usr/src/app <span class="nt">-p</span> 3000:3000 <span class="nt">--rm</span> sample-app
</code></pre></div></div>

<p>Test the app again in the browser at <a href="http://DOCKER_MACHINE_IP:3000/">http://DOCKER_MACHINE_IP:3000/</a>. Also, confirm that auto reload is <em>not</em> working. You can try with Docker Compose as well, but the results will be the same.</p>

<p>To get hot-reload working, we need to add an environment variable:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">-v</span> <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>:/usr/src/app <span class="nt">-p</span> 3000:3000 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">CHOKIDAR_USEPOLLING</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--rm</span> sample-app
</code></pre></div></div>

<p>Test it out again. You could add the variable to a <em>.env</em> file, however you  don’t need it for a production build.</p>

<p>Updated <em>docker-compose.yml</em> file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.3'</span>

<span class="na">services</span><span class="pi">:</span>

  <span class="na">sample-app</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">sample-app</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">.:/usr/src/app'</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">3000:3000'</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=development</span>
      <span class="pi">-</span> <span class="s">CHOKIDAR_USEPOLLING=true</span>
</code></pre></div></div>

<p>Want to destroy the Machine?</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="k">$(</span>docker-machine env <span class="nt">-u</span><span class="k">)</span>
<span class="nv">$ </span>docker-machine rm sample
</code></pre></div></div>

<h2 id="next-steps">Next Steps</h2>

<p>With that, you should now be able to add React to a larger Docker-powered project. If you’d like to learn more about working with React and Docker along with building and testing microservices, check out <a href="https://testdriven.io/">Microservices with Docker, Flask, and React</a>.</p>
